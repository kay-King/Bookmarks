<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹¦ç­¾ç®¡ç†å™¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --background-color: #f4f6f8;
            --card-background: #ffffff;
            --text-color: #333;
            --border-radius: 10px;
            --box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            --transition: all 0.3s ease;
            --button-height: 28px;
            --card-height: 160px;
            --card-width: 230px;
            --card-padding: 10px;
            --title-font-size: 16px;
            --url-font-size: 12px;
            --desc-font-size: 14px;
            --content-spacing: 6px;
            --sidebar-width-narrow: 60px;
            --sidebar-width-wide: 150px;
            --toolbar-height: 60px;
            --category-drag-bg: rgba(100, 149, 237, 0.2);
            --category-drag-border: #6495ED;
            --category-drag-opacity: 0.6;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background: var(--background-color);
            color: var(--text-color);
            line-height: 1.5;
            letter-spacing: 0.5px;
            box-sizing: border-box;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #toolbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            z-index: 1000;
            box-sizing: border-box;
            height: var(--toolbar-height);
        }

        #title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin: 0;
            flex-shrink: 0;
        }

        #toggle-sidebar-btn {
            margin-left: 10px;
            padding: 5px;
            width: 30px;
            height: var(--button-height);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
        }

        #controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            flex-grow: 1;
            justify-content: flex-end;
        }

        button {
            padding: 5px 10px;
            border: 1px solid var(--primary-color);
            border-radius: var(--border-radius);
            background: #fff;
            color: var(--primary-color);
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
            height: var(--button-height);
            display: flex;
            align-items: center;
            gap: 5px;
            box-sizing: border-box;
        }

        /* æŠ˜å å¼èœå•æ ·å¼ */
        .dropdown {
            position: relative;
            display: inline-block;
            margin-right: 10px;
        }

        .dropdown-content {
            position: absolute;
            left: 50%;
            top: 100%;
            background-color: #fff;
            min-width: 130px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border-radius: var(--border-radius);
            z-index: 1001;
            padding: 5px 0;
            margin-top: 2px;
            opacity: 0;
            visibility: hidden;
            transform: translateX(-50%) translateY(-5px);
            transition: opacity 0.2s ease, transform 0.2s ease;
        }

        .dropdown-content button {
            width: 100%;
            padding: 10px 16px;
            text-align: left;
            border: none;
            background: none;
            color: var(--text-color);
            border-radius: 0;
            height: auto;
            font-size: 13px;
            white-space: nowrap;
        }

        .dropdown-content button:hover {
            background-color: var(--background-color);
            color: var(--primary-color);
        }

        .dropbtn {
            font-size: 13px;
            font-weight: 500;
            padding: 5px 10px;
            border-radius: var(--border-radius);
            height: var(--button-height);
            min-width: 80px;
        }

        /* ä½¿ç”¨JavaScriptæ§åˆ¶èœå•æ˜¾ç¤º/éšè—ï¼Œé¿å…CSS hoverçš„å±€é™æ€§ */
        .dropdown.open .dropdown-content {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        .dropdown.open .dropbtn {
            background: var(--primary-color);
            color: white;
        }

        button:hover {
            background: var(--primary-color);
            color: white;
        }

        button:active {
            transform: scale(0.98);
        }

        .delete-btn {
            border-color: var(--danger-color);
            color: var(--danger-color);
        }

        .delete-btn:hover {
            background: var(--danger-color);
            color: white;
        }

        .batch-delete-btn {
            border-color: var(--danger-color);
            color: var(--danger-color);
        }

        .batch-delete-btn:hover {
            background: var(--danger-color);
            color: white;
        }

        #undo-btn {
            border-color: var(--success-color);
            color: var(--success-color);
        }

        #undo-btn:hover {
            background: var(--success-color);
            color: white;
        }

        #search {
            width: 150px;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: var(--border-radius);
            font-size: 12px;
            transition: var(--transition);
            box-sizing: border-box;
        }

        #search:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        #content-wrapper {
            display: flex;
            margin-top: var(--toolbar-height);
            height: calc(100vh - var(--toolbar-height));
        }

        #sidebar {
            width: 0;
            background: var(--card-background);
            padding: 20px 0;
            box-shadow: none;
            overflow-y: auto;
            font-size: 14px;
            flex-shrink: 0;
            border-right: none;
            transition: width 0.3s ease, padding 0.3s ease, box-shadow 0.3s ease, border-right 0.3s ease;
            scrollbar-width: thin;
            scrollbar-color: #b0b0b0 #d3d3d3;
        }

        #sidebar.wide {
            width: var(--sidebar-width-wide);
            padding: 20px;
            box-shadow: var(--box-shadow);
            border-right: 1px solid #d1d5db;
        }

        #sidebar::-webkit-scrollbar {
            width: 8px;
        }

        #sidebar::-webkit-scrollbar-thumb {
            background: #b0b0b0;
            border-radius: 4px;
            border: 2px solid #e9ecef;
        }

        #sidebar::-webkit-scrollbar-track {
            background: #d3d3d3;
            border-radius: 4px;
        }

        #sidebar h2 {
            margin: 0 0 15px;
            font-size: 16px;
            color: var(--text-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .category-item {
            padding: 8px 12px;
            margin: 5px 0;
            background: #ffffff;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .category-item:hover {
            background: #d1d5db;
        }

        .category-item.active {
            background: var(--primary-color);
            color: white;
        }
        
        .category-item.dragging {
            opacity: var(--category-drag-opacity);
            background-color: var(--category-drag-bg);
            border: 1px dashed var(--category-drag-border);
        }
        
        .category-item.drop-target {
            background-color: var(--category-drag-bg);
            border: 1px solid var(--category-drag-border);
        }

        #main-content {
            flex-grow: 1;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
            height: calc(100vh - var(--toolbar-height));
        }

        #main-content::-webkit-scrollbar {
            width: 4px;
        }

        #main-content::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 4px;
        }

        #tips {
            display: none;
            max-width: 1100px;
            margin: 0 auto 20px;
            padding: 15px 10px;
            border-left: 4px solid #ffca28;
            background: #fff8e1;
            border-radius: var(--border-radius);
            font-size: 14px;
            color: #856404;
            line-height: 1.6;
            position: relative;
            z-index: 1;
        }

        #container {
            max-width: 1100px;
            margin: 0 auto;
            box-sizing: border-box;
        }

        #bookmarks.bookmark-grid {
                display: grid;
                gap: 16px;
                justify-content: center;
                width: 100%;
                box-sizing: border-box;
                grid-template-columns: repeat(auto-fill, minmax(var(--card-width), 1fr));
                /* ç§»é™¤ min-heightï¼Œè®©é«˜åº¦åŠ¨æ€é€‚åº”å®é™…ä¹¦ç­¾æ•°é‡ */
        }

        #stats {
                max-width: 1100px;
                margin: 20px auto;
                padding: 15px;
                background: #fff;
                border-radius: var(--border-radius);
                box-shadow: var(--box-shadow);
                font-size: 14px;
                color: var(--text-color);
                text-align: center;
                display: none; /* é»˜è®¤éšè—ï¼Œæ¡ä»¶æ»¡è¶³æ—¶æ˜¾ç¤º */
        }

        #add-form, #help-modal, #export-modal, #message-form, #welcome-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            width: 400px;
            box-sizing: border-box;
        }

        #view-bookmark-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1001; /* æ¯”search-modalçš„z-indexé«˜ï¼Œç¡®ä¿è¯¦æƒ…é¡µå¼¹çª—æ˜¾ç¤ºåœ¨æœç´¢å¼¹çª—å‰é¢ */
            width: 400px;
            box-sizing: border-box;
        }

        /* ç»Ÿä¸€æ¨¡æ€æ¡†åŸºç¡€æ ·å¼ */
        .common-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            width: 600px;
            box-sizing: border-box;
        }

        /* æœç´¢æ¨¡æ€æ¡†æ ·å¼ */
        #search-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            width: 600px; /* è°ƒæ•´å¼¹çª—å®½åº¦ä¸º600px */
            height: 450px; /* è°ƒæ•´å¼¹çª—é«˜åº¦ä¸º450pxï¼Œé¿å…é®æŒ¡èœå•æ  */
            box-sizing: border-box;
            overflow: hidden !important; /* å¼ºåˆ¶éšè—æ‰€æœ‰æ–¹å‘çš„æ»šåŠ¨æ¡ */
        }

        #search-results {
            height: calc(100% - 100px); /* åŠ¨æ€è®¡ç®—é«˜åº¦ï¼Œç¡®ä¿ä¸ä¼šè¶…å‡ºçˆ¶å®¹å™¨ */
            overflow-y: auto;
            margin-top: 15px;
            border: none;
            padding: 0;
            position: relative;
        }

        #search-results::-webkit-scrollbar {
            width: 6px;
        }

        #search-results::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }

        #search-results::-webkit-scrollbar-track {
            background: #f5f5f5;
        }

        #welcome-modal {
            width: 500px;
        }

        #welcome-modal h3 {
            margin: 0 0 15px;
            font-size: 20px;
            color: var(--primary-color);
            text-align: center;
        }

        #welcome-content {
            font-size: 14px;
            color: var(--text-color);
            line-height: 1.6;
        }

        .step {
            margin: 10px 0;
        }

        .step strong {
            color: var(--primary-color);
        }

        #message-form {
            width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 25px;
            background: linear-gradient(135deg, #ffffff, #f9f9f9);
        }

        #message-form h3 {
            margin: 0 0 20px;
            font-size: 20px;
            color: var(--primary-color);
            text-align: center;
            font-weight: 500;
        }

        #message-form .form-group {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #message-form label {
            font-weight: 500;
            color: var(--text-color);
            font-size: 16px;
        }

        #message-form textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            min-height: 150px;
            background: #ffffff;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            transition: border-color 0.3s ease, background 0.3s ease;
        }

        #message-form textarea[readonly] {
            cursor: pointer;
        }

        #message-form textarea:not([readonly]) {
            border-color: var(--primary-color);
        }

        #message-form textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 5px rgba(0,123,255,0.3);
            outline: none;
        }

        #message-form .form-buttons {
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }

        #message-form button {
            flex: 1;
            padding: 10px;
            font-size: 14px;
            border-radius: 8px;
            height: 40px;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        #message-form button:hover {
            transform: translateY(-2px);
        }

        /* æœç´¢æ¨¡æ€æ¡†æ ·å¼ - æ­¤æ ·å¼å·²è¢«ä¸Šæ–¹æ ·å¼è¦†ç›–ï¼Œä¿ç•™ä»…ä½œå‚è€ƒ */
        /* #search-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            box-sizing: border-box;
        } */

        #search-modal h3 {
            margin: 0 0 15px;
            font-size: 18px;
            color: var(--primary-color);
            text-align: center;
        }

        #search-modal .search-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        #search-modal-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: var(--border-radius);
            font-size: 12px;
            box-sizing: border-box;
        }

        #search-modal-input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        #search-modal-submit {
            padding: 5px 15px;
            border: 1px solid var(--primary-color);
            border-radius: var(--border-radius);
            background: var(--primary-color);
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
            height: var(--button-height);
        }

        #search-modal-submit:hover {
            background: #0056b3;
        }

        #search-modal-close {
            padding: 5px 15px;
            border: 1px solid var(--secondary-color);
            border-radius: var(--border-radius);
            background: #fff;
            color: var(--secondary-color);
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
            height: var(--button-height);
        }

        #search-modal-close:hover {
            background: var(--secondary-color);
            color: white;
        }

        /* æœç´¢ç»“æœåˆ—è¡¨æ ·å¼ */
        #search-results {
            max-height: 400px; /* è®¾ç½®åˆé€‚çš„ç»“æœåŒºåŸŸæœ€å¤§é«˜åº¦ */
            overflow-y: auto;
            margin-top: 15px;
            border: none;
            padding: 0;
        }

        .search-result-item {
            padding: 12px 10px; /* å¢åŠ å†…è¾¹è·ç¡®ä¿å†…å®¹æœ‰è¶³å¤Ÿç©ºé—´ */
            margin-bottom: 8px;
            border: 1px solid #e0e0e0;
            border-radius: var(--border-radius);
            background: white;
            cursor: pointer;
            transition: var(--transition);
            box-sizing: border-box;
        }

        .search-result-item:hover {
            background: #f8f9fa;
            border-color: var(--primary-color);
        }

        .search-result-name {
            font-weight: 500;
            color: var(--text-color);
            margin-bottom: 8px; /* å¢åŠ åç§°ä¸é“¾æ¥ä¹‹é—´çš„é—´è· */
            display: block;
            font-size: 15px; /* è°ƒæ•´å­—ä½“å¤§å° */
            line-height: 1.6; /* å¢å¤§è¡Œé—´è·ï¼Œä½¿ä¸¤è¡Œæ–‡æœ¬æ›´åŠ æ¸…æ™° */
            max-height: 4em; /* å¢åŠ é«˜åº¦ç¡®ä¿ä¸¤è¡Œæ–‡æœ¬å®Œå…¨æ˜¾ç¤º */
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            cursor: pointer; /* æ·»åŠ é¼ æ ‡æŒ‡é’ˆæ ·å¼ */
        }

        .search-result-name:hover {
            color: var(--primary-color); /* é¼ æ ‡æ‚¬åœæ—¶å˜ä¸ºè“è‰² */
            text-decoration: underline; /* é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºä¸‹åˆ’çº¿ */
        }

        .search-result-url {
            font-size: 15px; /* è°ƒå¤§URLå­—ä½“å¤§å°ï¼Œå¢å¼ºå¯è¯»æ€§ */
            color: var(--primary-color);
            text-decoration: none;
            display: block;
            word-break: break-all;
            margin-top: 5px;
        }

        .search-result-url:hover {
            text-decoration: underline;
        }

        #no-search-results {
            text-align: center;
            color: var(--secondary-color);
            padding: 20px;
            display: none;
        }

        #message-form #save-message-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            display: none;
        }

        #message-form #save-message-btn:hover {
            background: #0056b3;
        }

        #message-form #cancel-message-btn {
            background: #fff;
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
            display: none;
        }

        #message-form #cancel-message-btn:hover {
            background: var(--danger-color);
            color: white;
        }

        #message-form #close-message-btn {
            background: #fff;
            color: var(--secondary-color);
            border: 1px solid var(--secondary-color);
        }

        #message-form #close-message-btn:hover {
            background: var(--secondary-color);
            color: white;
        }

        /* å¸®åŠ©æ¨¡æ€æ¡†æ ·å¼ */
        #help-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-sizing: border-box;
        }

        #help-modal::-webkit-scrollbar {
            width: 4px;
        }

        #help-modal::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 4px;
        }

        #help-modal h3 {
            margin: 0 0 20px;
            font-size: 20px;
            color: var(--primary-color);
            text-align: center;
        }

        #help-modal h4 {
            margin: 20px 0 10px;
            font-size: 16px;
            color: var(--text-color);
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 5px;
        }

        #help-modal p {
            margin: 0 0 10px;
            font-size: 14px;
            color: var(--text-color);
            line-height: 1.6;
        }

        #help-modal ul {
            margin: 0 0 10px 20px;
            padding: 0;
            list-style-type: disc;
        }

        #help-modal li {            margin: 5px 0;            font-size: 14px;            color: var(--text-color);        }

        #help-modal .important-tip {
            background-color: rgba(255, 193, 7, 0.1);
            border-left: 4px solid #ffc107;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 4px;
            font-weight: 500;
            color: #856404;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        #help-modal .important-tip::before {
            content: "âš ï¸ ";
            margin-right: 5px;
        }

        #view-bookmark-modal #bookmark-details {
            max-height: 300px;
            overflow-y: auto;
        }

        #view-bookmark-modal #bookmark-details::-webkit-scrollbar {
            width: 6px;
        }

        #view-bookmark-modal #bookmark-details::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }

        #view-bookmark-modal #bookmark-details::-webkit-scrollbar-track {
            background: #f5f5f5;
        }

        .form-group {
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            align-items: baseline;
            gap: 5px;
        }

        .form-group label {
            font-weight: 500;
            color: var(--text-color);
            margin-right: 5px;
            min-width: 50px;
        }

        .form-group p {
            margin: 0;
            flex: 1;
            word-break: break-word;
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: var(--border-radius);
            font-size: 14px;
            box-sizing: border-box;
            transition: var(--transition);
        }

        input:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .bookmark-grid {
            display: grid;
            gap: 16px;
            justify-content: center;
            width: 100%;
            box-sizing: border-box;
            grid-template-columns: repeat(auto-fill, minmax(var(--card-width), 1fr));
        }

        .bookmark-card {
            position: relative;
            height: var(--card-height);
            width: var(--card-width);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            cursor: default;
            overflow: hidden;
            padding: var(--card-padding);
            user-select: none;
            perspective: 1000px;
        }

        .bookmark-card.placeholder {
            visibility: hidden;
        }

        .bookmark-card.edit-mode {
            cursor: default;
        }

        .bookmark-card.dragging {
            opacity: 0.6;
            cursor: grabbing;
            border: 2px dashed #87CEFA;
            transition: transform 1s ease-out, opacity 1s ease, scale 1s ease;
        }

        .bookmark-card.drop-target {
            border: 1.5px dashed #2196f3;
            box-shadow: 0 0 8px 1px #2196f3;
            opacity: 1;
            z-index: 20;
            animation: drop-glow 0.2s linear;
            transition: border 0.1s, box-shadow 0.1s, transform 0.2s cubic-bezier(.4,2,.6,1), opacity 0.1s;
                @keyframes drop-glow {
                        0% { box-shadow: 0 0 0 0 #2196f3; }
                        100% { box-shadow: 0 0 8px 1px #2196f3; }
                }


        }

        .bookmark-card.swapping {
            position: absolute;
            transition: transform 1s ease-out, opacity 1s ease, scale 1s ease;
            z-index: 10;
        }

        .main-card-container {
            position: relative;
            width: 100%;
            height: 100%;
            perspective: 1000px;
        }

        .main-card {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            transform-style: preserve-3d;
            transition: transform 0.6s ease;
        }

        .main-card.flipped {
            transform: rotateY(180deg);
        }

        .main-card-front, .main-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: var(--border-radius);
            padding: var(--card-padding);
            box-sizing: border-box;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
        }

        .main-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: var(--border-radius);
            padding: var(--card-padding);
            box-sizing: border-box;
            backface-visibility: hidden;
            transform: rotateY(180deg);
            z-index: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .main-card-back .desc {
            font-size: 13px;
            color: #444;
            line-height: 1.5;
            margin: 0;
            white-space: pre-wrap;
            word-break: break-word;
            overflow-y: auto;
            flex-grow: 1;
            min-height: 0;
            scrollbar-width: thin;
            scrollbar-color: #ccc #f5f5f5;
        }

        .main-card-back .desc::-webkit-scrollbar {
            width: 6px;
        }

        .main-card-back .desc::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }

        .main-card-back .desc::-webkit-scrollbar-track {
            background: #f5f5f5;
        }

        .main-card-back .desc-title {
            color: #1e90ff;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .main-card-back .desc {
            font-size: 13px;
            color: #444;
            line-height: 1.5;
            margin: 0;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .main-card-back .no-desc {
            color: #1e90ff;
            font-size: 14px;
        }

        .bookmark-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            gap: 8px;
        }

        .main-card-front h3 {
            margin: 0;
            font-size: var(--title-font-size);
            font-weight: 600;
            line-height: 1.2;
            flex-shrink: 0;
            cursor: default;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .main-card-front h3 .favicon-container {
                display: inline-flex;
                align-items: center;
                margin-right: 5px;
        }

        .main-card-front h3 .favicon {
                width: var(--title-font-size);
                height: var(--title-font-size);
                vertical-align: middle;
                display: none; /* é»˜è®¤éšè—ï¼Œç›´åˆ°åŠ è½½æˆåŠŸ */
        }

        .main-card-front h3 .title-text {
            transition: color 0.2s ease;
            flex-grow: 1;
        }

        .main-card-front:not(.edit-mode) h3 .title-text:hover {
            color: var(--primary-color);
            cursor: pointer;
            text-decoration: underline;
        }

        .main-card-front p.url {
            margin: 0 0 4px 0;
            font-size: 15px;
            color: #5a6470;
            line-height: 1.2;
            flex-shrink: 0;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .main-card-front .desc-container {
            margin: 0;
            flex-grow: 1;
            overflow: hidden;
        }

        .main-card-front .desc {
            font-size: var(--desc-font-size);
            color: #666;
            line-height: 1.3;
            margin: 0;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .main-card-front .desc:empty::before {
            content: "æš‚æ— ç®€ä»‹";
            color: #b0b0b0;
        }

        .main-card-front a {
            color: var(--primary-color);
            text-decoration: none;
            pointer-events: none;
        }

        .main-card-front:hover a {
            pointer-events: auto;
        }

        .main-card-front a:hover {
            text-decoration: underline;
        }

        .main-card-front .action-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: var(--button-height);
            margin-top: auto;
        }

        .category-tag {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 11px;
            color: #666;
            background-color: var(--secondary-color);
            max-width: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-weight: 500;
        }

        .bookmark-checkbox {
            width: 14px;
            height: 14px;
            position: absolute;
            top: 6px;
            right: 6px;
            display: none;
            z-index: 10;
        }

        .bookmark-checkbox.visible {
            display: block;
        }

        .action-bar {
            position: relative;
            z-index: 50;
            pointer-events: auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .action-buttons {
            display: flex;
            gap: 6px;
            align-items: center;
            position: relative;
            z-index: 51;
            pointer-events: auto;
        }

        .action-buttons button {
            padding: 3px 6px;
            font-size: 10px;
            min-width: 40px;
            border-radius: 5px;
            background: #fff;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            cursor: pointer;
            pointer-events: auto;
            position: relative;
            z-index: 52;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .edit-mode .hover-area {
            pointer-events: none;
        }

        .main-card {
            position: relative;
            z-index: 10;
            pointer-events: auto;
        }

        .main-card-front {
            pointer-events: auto;
            z-index: 2;
        }

        .action-buttons button:hover {
            background: var(--primary-color);
            color: white;
        }

        .action-buttons .delete-btn {
            border-color: var(--danger-color);
            color: var(--danger-color);
        }
        
        /* åˆ†ç±»é¡¹æ ·å¼ */
        .category-item {
            padding: 8px 12px;
            margin: 2px 0;
            border-radius: 6px;
            cursor: default;
            transition: all 0.2s ease;
            user-select: none;
            position: relative;
            z-index: 1;
        }
        
        .category-item:hover {
            background-color: rgba(0, 123, 255, 0.1);
            cursor: grab;
        }
        
        .category-item.active {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
        }
        
        .category-item.dragging {
            opacity: 0.6;
            cursor: grabbing;
        }
        
        /* åˆ†ç±»é¡¹äº¤æ¢åŠ¨ç”» */
        .category-item {
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        /* åˆ†ç±»äº¤æ¢åŠ¨ç”»ç±» - è¶…æ˜æ˜¾ç‰ˆ */
        .category-item.swap-animation {
            animation: swapMove 0.8s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            z-index: 10;
            background-color: rgba(0, 123, 255, 0.3) !important;
        }
        
        @keyframes swapMove {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            30% {
                transform: translateY(-15px) scale(1.1);
                opacity: 0.8;
                box-shadow: 0 10px 20px rgba(0, 123, 255, 0.3);
            }
            70% {
                transform: translateY(5px) scale(1.05);
                opacity: 0.9;
            }
            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
                box-shadow: none;
            }
        }
        
        /* æ‹–æ‹½ç›®æ ‡é«˜äº®æ ·å¼ */
        .category-item.drop-target {
            background-color: rgba(0, 123, 255, 0.2);
            border: 1px dashed var(--primary-color);
            padding: 6px 10px;
        }
        
        .category-item.drop-target-before::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--primary-color);
            z-index: 2;
        }
        
        .category-item.drop-target-after::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--primary-color);
            z-index: 2;
        }
        }

        .action-buttons .delete-btn:hover {
            background: var(--danger-color);
            color: white;
        }

        #view-bookmark-modal button, #export-modal button, #help-modal button, #message-form button, #welcome-modal button {
            margin: 10px 0;
            padding: 8px 12px;
            font-size: 12px;
            border-radius: var(--border-radius);
            background: #fff;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        #view-bookmark-modal button:hover, #export-modal button:hover, #help-modal button:hover, #welcome-modal button:hover {
            background: var(--primary-color);
            color: white;
        }

        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        #pagination {
                max-width: 1100px;
                margin: 20px auto 0;
                display: flex;
                justify-content: center;
                gap: 10px;
                padding: 10px;
                display: none; /* é»˜è®¤éšè—ï¼Œæ¡ä»¶æ»¡è¶³æ—¶æ˜¾ç¤º */
        }

        #pagination button {
            padding: 5px 12px;
            min-width: 30px;
            text-align: center;
        }

        #pagination button.active {
            background: var(--primary-color);
            color: white;
            border: 1px solid var(--primary-color);
        }

        #pagination button:disabled {
            border-color: #ced4da;
            color: #ced4da;
            cursor: not-allowed;
        }

        #pagination button:disabled:hover {
            background: #fff;
            color: #ced4da;
        }

        #sort-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            width: 300px;
            box-sizing: border-box;
        }

        #sort-modal h3 {
            margin: 0 0 15px;
            font-size: 18px;
            color: var(--primary-color);
            text-align: center;
        }

        #sort-modal button {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            margin: 10px 0;
            padding: 8px 12px;
            font-size: 12px;
            border-radius: var(--border-radius);
            background: #fff;
            color: #000;
            border: 1px solid var(--primary-color);
            transition: var(--transition);
            text-align: center;
        }

        #sort-modal button:hover {
            background: var(--primary-color);
            color: white;
        }

        .message-instructions, .export-tips {
            font-size: 12px;
            color: var(--secondary-color);
            margin-bottom: 15px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: var(--border-radius);
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: calc(100vh - var(--toolbar-height));
            text-align: center;
            color: var(--secondary-color);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .empty-state .cartoon-book {
            width: 150px;
            height: 150px;
            position: relative;
            margin-bottom: 30px;
        }

        .empty-state .cartoon-book .book-cover {
            position: absolute;
            width: 100px;
            height: 130px;
            background: #4dabf7;
            border-radius: 5px 15px 15px 5px;
            top: 10px;
            left: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 2;
        }

        .empty-state .cartoon-book .book-spine {
            position: absolute;
            width: 15px;
            height: 130px;
            background: #339af0;
            top: 10px;
            left: 15px;
            z-index: 1;
        }

        .empty-state .cartoon-book .book-page {
            position: absolute;
            width: 90px;
            height: 120px;
            background: #fff;
            border-radius: 5px 10px 10px 5px;
            top: 15px;
            left: 30px;
            z-index: 3;
            animation: flip-page 2.5s infinite ease-in-out;
        }

        .empty-state .cartoon-book .bookmark {
            position: absolute;
            width: 15px;
            height: 40px;
            background: #f783ac;
            top: -5px;
            left: 60px;
            border-radius: 0 0 5px 5px;
            z-index: 4;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .empty-state .ribbons {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .empty-state .ribbon {
            position: absolute;
            width: 20px;
            height: 100px;
            background: rgba(247, 131, 172, 0.7);
            border-radius: 5px;
            animation: float 6s infinite ease-in-out;
            transform-origin: center;
        }

        .empty-state .ribbon:nth-child(1) {
            left: 20%;
            top: 10%;
            animation-delay: 0s;
        }

        .empty-state .ribbon:nth-child(2) {
            left: 40%;
            top: 30%;
            animation-delay: 2s;
            background: rgba(77, 171, 247, 0.7);
        }

        .empty-state .ribbon:nth-child(3) {
            left: 60%;
            top: 20%;
            animation-delay: 4s;
            background: rgba(40, 167, 69, 0.7);
        }

        @keyframes flip-page {
            0%, 100% { transform: rotateY(0deg); }
            50% { transform: rotateY(-15deg); }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(5deg);
                opacity: 0.7;
            }
            50% {
                transform: translateY(-20px) rotate(-5deg);
                opacity: 1;
            }
        }

        .empty-state h2 {
            font-size: 24px;
            margin: 0 0 10px;
            color: var(--text-color);
            z-index: 1;
        }

        .empty-state p {
            font-size: 16px;
            margin: 0 0 20px;
            max-width: 500px;
            line-height: 1.6;
            z-index: 1;
        }

        .empty-state .button-group {
            display: flex;
            gap: 15px;
            z-index: 1;
        }

        .empty-state .action-btn {
            padding: 10px 20px;
            font-size: 14px;
            border-radius: var(--border-radius);
            background: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .empty-state .action-btn:hover {
            background: #0056b3;
            transform: scale(1.05);
        }

        .empty-state .secondary-btn {
            background: #fff;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .empty-state .secondary-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .hover-area {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 33%;
            z-index: 10;
            pointer-events: auto;
        }
        
        /* ç»Ÿä¸€ä¸»èœå•æŒ‰é’®é—´è· */
        .dropdown {
            margin-right: 15px;
        }
        
        /* æœç´¢æŒ‰é’®ä¸å…¶ä»–ä¸»èœå•æŒ‰é’®é—´è·ç»Ÿä¸€ */
        #search-btn {
            margin-right: 15px;
        }
        
        /* ä¿®æ­£å­èœå•ä½ç½®ï¼Œç¡®ä¿åœ¨ä¸»èœå•æ­£ä¸‹æ–¹ */
        .dropdown-content {
            left: 50%;
            transform: translateX(-50%) translateY(-5px);
            width: 130px;
            top: 100%;
            margin-top: 2px;
        }
    </style>
</head>
<body>
    <div id="toolbar">
        <div id="title">ä¹¦ç­¾ç®¡ç†å™¨</div>
        <button id="toggle-sidebar-btn" onclick="toggleSidebar()">â¤</button>
        <div id="controls" style="margin-left: 10px;">
            <!-- æ’¤é”€æŒ‰é’®å’Œå®ŒæˆæŒ‰é’®ç§»åˆ°ä¸»å·¥å…·æ  -->
            <button id="undo-btn" onclick="undoDelete()" style="display: none; margin: 0 8px;">â†©ï¸ æ’¤é”€</button>
            <button id="done-btn" onclick="toggleEditMode()" style="display: none; margin: 0 8px;">âœ… å®Œæˆ</button>
            <button id="batch-delete-btn" class="batch-delete-btn" onclick="batchDeleteBookmarks()" style="display: none; margin: 0 8px;">ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤</button>
            
            <!-- æœç´¢æŒ‰é’®ä½œä¸ºä¸»èœå• -->
            <button id="search-btn" onclick="showSearchModal()" class="dropbtn">ğŸ” æœç´¢</button>
            
            <!-- æ“ä½œä¸»èœå• -->
            <div class="dropdown">
                <button class="dropbtn">ğŸ“‹ æ“ä½œ â–¾</button>
                <div class="dropdown-content">
                    <button onclick="toggleAddForm(true)">â• æ·»åŠ ä¹¦ç­¾</button>
                    <button onclick="showExportModal()">ğŸ“¤ å¯¼å‡ºä¹¦ç­¾</button>
                    <button onclick="document.getElementById('import-file').click()">ğŸ“¥ å¯¼å…¥ä¹¦ç­¾</button>
                    <input type="file" id="import-file" style="display: none;" accept=".json,.txt,.html" onchange="importBookmarks(event)">
                </div>

            </div>
            
            <!-- æ•°æ®ä¸»èœå• -->
            <div class="dropdown">
                <button class="dropbtn">ğŸ“Š æ•°æ® â–¾</button>
                <div class="dropdown-content">
                    <button id="edit-mode-btn" onclick="toggleEditMode()">âœï¸ ç¼–è¾‘ä¹¦ç­¾</button>
                    <button id="delete-page-btn" class="delete-btn" onclick="deletePageBookmarks()">ğŸ—‘ï¸ åˆ é™¤æœ¬é¡µä¹¦ç­¾</button>
                </div>
            </div>
            
            <!-- å·¥å…·èœå• -->
            <div class="dropdown">
                <button class="dropbtn">ğŸ› ï¸ å·¥å…· â–¾</button>
                <div class="dropdown-content">
                    <button id="sort-btn" onclick="showSortModal()">ğŸ“ ä¹¦ç­¾æ’åº</button>
                    <button onclick="showHelpModal()">â“ ä½¿ç”¨å¸®åŠ©</button>
                    <button onclick="toggleMessageForm()">ğŸ“ ç•™è¨€æ¿</button>
                </div>
            </div>
        </div>
    </div>
    <div id="loading-indicator" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255, 255, 255, 0.9); padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 2000;">
        <p>æ­£åœ¨åŠ è½½ä¹¦ç­¾ï¼Œè¯·ç¨å€™...</p>
    </div>
    <div id="content-wrapper">
                <div id="sidebar">
                        <h2>åˆ†ç±»</h2>
                        <div id="categories"></div>
                </div>
                <div id="main-content">
                        <div id="tips">æ‚¨å¯ä»¥æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤å’Œæ‹–åŠ¨æ’åºä¹¦ç­¾ã€‚ä½¿ç”¨â€œå¯¼å‡ºä¹¦ç­¾â€ä¿å­˜æ•°æ®åˆ° bookmarks.jsonã€txt æˆ– html æ–‡ä»¶ï¼Œhtml æ–‡ä»¶å¯ç›´æ¥å¯¼å…¥æµè§ˆå™¨ã€‚æ–‡ä»¶å°†ä¿å­˜åˆ°æ‚¨çš„ä¸‹è½½ç›®å½•ï¼Œè¯·æ‰‹åŠ¨ç§»åŠ¨åˆ°ç¨‹åºæ‰€åœ¨æ–‡ä»¶å¤¹ä¸ä»–äººåˆ†äº«ã€‚å¯¼å…¥æ—¶å°†æ–‡ä»¶æ”¾å…¥åŒä¸€ç›®å½•å¹¶ç‚¹å‡»â€œå¯¼å…¥ä¹¦ç­¾â€åŠ è½½ã€‚</div>
                        <div id="container">
                                <div id="bookmarks" class="bookmark-grid"></div>
                                <div id="stats"></div>
                                <div id="pagination"></div>
                        </div>
                </div>
        </div>

    <div id="overlay" onclick="hideAllModals()"></div>
    <div id="view-bookmark-modal">
        <h3>ä¹¦ç­¾è¯¦æƒ…</h3>
        <div id="bookmark-details"></div>
        <button onclick="hideBookmarkModal()">å…³é—­</button>
    </div>
    <!-- æœç´¢æ¨¡æ€æ¡† -->
    <div id="search-modal">
        <h3>æœç´¢ä¹¦ç­¾</h3>
        <div class="search-input-container">
            <input type="text" id="search-modal-input" placeholder="è¯·è¾“å…¥ä¹¦ç­¾åç§°" autofocus>
            <button id="search-modal-submit" onclick="performModalSearch()">æœç´¢</button>
            <button id="search-modal-close" onclick="hideSearchModal()">å…³é—­</button>
        </div>
        <div id="search-results"></div>
        <div id="no-search-results">æœªæ‰¾åˆ°åŒ¹é…çš„ä¹¦ç­¾</div>
    </div>
    <div id="help-modal">
        <h3>ä½¿ç”¨å¸®åŠ©</h3>
        <div id="help-content">
            <h4>ä»€ä¹ˆæ˜¯ä¹¦ç­¾ç®¡ç†å™¨ï¼Ÿ</h4>
            <p>è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç¦»çº¿ä¹¦ç­¾ç®¡ç†å·¥å…·ï¼Œå¸®åŠ©æ‚¨åœ¨æœ¬åœ°æ•´ç†ä¹¦ç­¾å’Œç•™è¨€ï¼Œæ— éœ€è”ç½‘å³å¯ä½¿ç”¨ã€‚æ”¯æŒåˆ†ç±»ç®¡ç†ã€æœç´¢ç­‰å¤šç§åŠŸèƒ½ï¼Œé€‚åˆä¸ªäººä½¿ç”¨æˆ–å›¢é˜Ÿå…±äº«ã€‚</p>
            
            <hr>

            <h4>ä¸»è¦åŠŸèƒ½</h4>
            <ul>
                <li><strong>æ·»åŠ ä¹¦ç­¾</strong>ï¼šç‚¹å‡»â€œæ·»åŠ ä¹¦ç­¾â€ï¼Œå¡«å†™åç§°ã€é“¾æ¥ï¼ˆå¯é€‰ï¼‰ã€ç®€ä»‹å’Œåˆ†ç±»ï¼ŒæŒ‰å›è½¦é”®æˆ–ç‚¹å‡»â€œä¿å­˜â€å¿«é€Ÿæ·»åŠ ã€‚</li>
                <li><strong>ç¼–è¾‘ä¸åˆ é™¤</strong>ï¼šè¿›å…¥â€œç¼–è¾‘ä¹¦ç­¾â€æ¨¡å¼ï¼Œå¯ä¿®æ”¹æˆ–åˆ é™¤ä¹¦ç­¾ï¼Œæ”¯æŒæ‰¹é‡åˆ é™¤æœ¬é¡µæˆ–é€‰ä¸­ä¹¦ç­¾ï¼Œå¹¶å¯æ’¤é”€æ“ä½œã€‚åˆ é™¤åä¾§è¾¹æ åˆ†ç»„è‡ªåŠ¨æ›´æ–°ã€‚</li>
                <li><strong>åˆ†ç±»ç®¡ç†</strong>ï¼šå·¦ä¾§åˆ†ç±»æ æ˜¾ç¤ºæ‰€æœ‰åˆ†ç»„ï¼Œé¼ æ ‡æ‚¬æµ®æ˜¾ç¤ºå®Œæ•´åç§°ï¼Œç‚¹å‡»åˆ‡æ¢æ˜¾ç¤ºå†…å®¹ã€‚</li>
                <li><strong>æ‹–æ‹½æ’åº</strong>ï¼šæ”¯æŒä¹¦ç­¾å¡ç‰‡å’Œåˆ†ç±»çš„æ‹–æ‹½äº¤æ¢ä½ç½®ã€‚æ‹–åŠ¨ä¹¦ç­¾å¡ç‰‡æ—¶ï¼Œå½“é¼ æ ‡é è¿‘ç›®æ ‡å¡ç‰‡ï¼ˆä¸Šä¸‹å·¦å³20pxèŒƒå›´å†…ï¼‰ï¼Œç›®æ ‡å¡ç‰‡ä¼šæ˜¾ç¤ºè“è‰²è™šçº¿æç¤ºæ¡†ï¼Œæ¾å¼€é¼ æ ‡å³å¯å®Œæˆä½ç½®äº¤æ¢ã€‚æ‹–æ‹½æ“ä½œå…·æœ‰åŠ¨ç”»æ•ˆæœï¼Œæå‡æ“ä½œä½“éªŒã€‚</li>
                <li><strong>æœç´¢åŠŸèƒ½</strong>ï¼šåœ¨æœç´¢æ¡†è¾“å…¥ä¹¦ç­¾åç§°ï¼Œå®æ—¶ç­›é€‰åŒ¹é…ç»“æœã€‚</li>
                <li><strong>ç•™è¨€æ¿</strong>ï¼šåŒå‡»ç•™è¨€åŒºåŸŸç¼–è¾‘å†…å®¹ï¼Œå¯ç”¨äºè®°å½•ç¬”è®°ã€å¾…åŠäº‹é¡¹æˆ–å›¢é˜Ÿæ¶ˆæ¯ï¼Œå¯¼å…¥æ—¶è¿½åŠ æ–°å†…å®¹ï¼Œé‡å¤è·³è¿‡ã€‚</li>
                <li><strong>å¯¼å‡ºä¸å¯¼å…¥</strong>ï¼š
                    <ul>
                        <li><strong>JSON</strong>ï¼šå®Œæ•´å¤‡ä»½ä¹¦ç­¾å’Œç•™è¨€ï¼Œæ¨èç”¨äºæ•°æ®è¿ç§»ã€‚</li>
                        <li><strong>TXT</strong>ï¼šæ ¼å¼ä¸ºâ€œåç§°|URL|ç®€ä»‹|åˆ†ç»„â€ï¼Œæ¯è¡Œä¸€æ¡ï¼Œæ”¯æŒå¯¼å…¥å’ŒæŸ¥çœ‹ï¼Œé‡å¤ä¹¦ç­¾ï¼ˆURL ç›¸åŒï¼‰è·³è¿‡ã€‚</li>
                        <li><strong>HTML</strong>ï¼šæµè§ˆå™¨å…¼å®¹æ ¼å¼ï¼Œå¯ç›´æ¥å¯¼å…¥Chromeã€Edgeç­‰æµè§ˆå™¨ï¼Œä»…å«ä¹¦ç­¾ã€‚</li>
                    </ul>
                </li>
            </ul>
            
            <hr>

            <h4>æ“ä½œæç¤º</h4>
            <p>æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ï¼ˆlocalStorageï¼‰ï¼Œå®¹é‡æœ‰é™ï¼ˆçº¦4MBï¼‰ã€‚å»ºè®®å®šæœŸå¯¼å‡ºå¤‡ä»½ï¼Œé¿å…å› æ¸…ç©ºç¼“å­˜æˆ–æµè§ˆå™¨é™åˆ¶å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</p>
            
            <p>å¿«æ·é”®æ”¯æŒï¼š
                <ul>
                    <li><strong>Ctrl + S</strong>ï¼šæ‰“å¼€æ·»åŠ ä¹¦ç­¾çª—å£ã€‚</li>
                    <li><strong>Enter</strong>ï¼šåœ¨æ·»åŠ /ç¼–è¾‘ä¹¦ç­¾çª—å£ä¸­å¿«é€Ÿä¿å­˜ã€‚</li>
                    <li><strong>Esc</strong>ï¼šå…³é—­æ‰€æœ‰å¼¹çª—å¹¶é€€å‡ºç¼–è¾‘æ¨¡å¼ã€‚</li>
                </ul>
            </p>
            
            <p><strong>æ‹–æ‹½æç¤º</strong>ï¼šæ‹–æ‹½ä¹¦ç­¾å¡ç‰‡æ—¶ï¼Œè¯·å°†é¼ æ ‡ç§»åŠ¨åˆ°å¡ç‰‡ä¸Šæ–¹å¹¶æŒ‰ä½å·¦é”®ï¼Œå½“é è¿‘ç›®æ ‡å¡ç‰‡æ—¶ï¼Œç›®æ ‡å¡ç‰‡ä¼šæ˜¾ç¤ºè“è‰²è™šçº¿æç¤ºæ¡†ï¼Œæ­¤æ—¶æ¾å¼€é¼ æ ‡å³å¯å®Œæˆä½ç½®äº¤æ¢ã€‚ä¼˜åŒ–åçš„æ‹–æ‹½æ£€æµ‹èŒƒå›´æ‰©å¤§è‡³ä¸Šä¸‹å·¦å³å„20pxï¼Œä½¿æ“ä½œæ›´åŠ çµæ•ã€‚</p>
            
            <hr>

            <h4>ä½¿ç”¨ç¤ºä¾‹</h4>
            <p><strong>åœºæ™¯1ï¼šä¸ªäººæ”¶è—</strong><br>å°†å¸¸ç”¨ç½‘ç«™ï¼ˆå¦‚â€œGitHubâ€ï¼‰æ·»åŠ ä¹¦ç­¾ï¼Œåˆ†ç±»ä¸ºâ€œå¼€å‘å·¥å…·â€ï¼Œæ·»åŠ ç®€ä»‹â€œä»£ç æ‰˜ç®¡å¹³å°â€ã€‚é€šè¿‡æœç´¢â€œGitâ€å¿«é€Ÿæ‰¾åˆ°ã€‚</p>
            <p><strong>åœºæ™¯2ï¼šå›¢é˜Ÿå…±äº«</strong><br>å¯¼å‡ºä¹¦ç­¾ä¸ºJSONæˆ–TXTæ–‡ä»¶ï¼Œæ”¾å…¥å…±äº«æ–‡ä»¶å¤¹ï¼Œå›¢é˜Ÿæˆå‘˜å¯¼å…¥åå³å¯ä½¿ç”¨ç›¸åŒä¹¦ç­¾é›†ã€‚ç•™è¨€æ¿å¯è®°å½•æ›´æ–°æ—¥å¿—ã€‚</p>
            
            <hr>

            <h4>å¸¸è§é—®é¢˜</h4>
            <ul>
                <li><strong>å¦‚ä½•åˆ†äº«ä¹¦ç­¾ï¼Ÿ</strong> å¯¼å‡ºåå°†æ–‡ä»¶æ‰‹åŠ¨ç§»åŠ¨åˆ°ç¨‹åºæ–‡ä»¶å¤¹æˆ–äº‘ç›˜ï¼Œä¸ä»–äººå…±äº«ã€‚</li>
                <li><strong>å¯¼å…¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ</strong> æ£€æŸ¥æ–‡ä»¶æ ¼å¼ï¼ˆä»…æ”¯æŒ .jsonã€.txtã€.htmlï¼‰æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿æ–‡ä»¶æœªæŸåã€‚</li>
                <li><strong>æ•°æ®ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ</strong> æ£€æŸ¥æ˜¯å¦æ¸…ç©ºäº†æµè§ˆå™¨ç¼“å­˜ï¼Œå»ºè®®æ¢å¤å‰å¯¼å‡ºçš„å¤‡ä»½æ–‡ä»¶ã€‚</li>
                <li><strong>æ‹–æ‹½ä¸çµæ•æ€ä¹ˆåŠï¼Ÿ</strong> ç¡®ä¿é¼ æ ‡æŒ‡é’ˆåœ¨ä¹¦ç­¾å¡ç‰‡ä¸ŠæŒ‰ä½å·¦é”®ï¼Œç¼“æ…¢ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®é™„è¿‘ï¼ˆ20pxèŒƒå›´å†…ï¼‰ï¼Œè“è‰²è™šçº¿æç¤ºæ¡†ä¼šæ›´çµæ•åœ°æ˜¾ç¤ºã€‚</li>
                <li><strong>å¦‚ä½•åˆ é™¤ç©ºåˆ†ç±»ï¼Ÿ</strong> åˆ é™¤åˆ†ç±»ä¸‹çš„æ‰€æœ‰ä¹¦ç­¾åï¼Œç©ºåˆ†ç±»ä¼šè‡ªåŠ¨ä»ä¾§è¾¹æ ç§»é™¤ã€‚</li>
            </ul>
            
            <hr>

            <h4>é«˜çº§æŠ€å·§</h4>
            <ul>
                <li><strong>æ‰¹é‡æ•´ç†</strong>ï¼šè¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œå‹¾é€‰å¤šå¼ å¡ç‰‡åæ‰¹é‡åˆ é™¤ï¼ŒèŠ‚çœæ—¶é—´ã€‚</li>
                <li><strong>è‡ªå®šä¹‰åˆ†ç±»</strong>ï¼šæ·»åŠ ä¹¦ç­¾æ—¶è¾“å…¥æ–°åˆ†ç±»åï¼Œè‡ªåŠ¨åˆ›å»ºæ–°åˆ†ç»„ã€‚</li>
                <li><strong>å¿«é€Ÿæµè§ˆ</strong>ï¼šé¼ æ ‡æ‚¬åœå¡ç‰‡åº•éƒ¨ä¸‰åˆ†ä¹‹ä¸€åŒºåŸŸï¼Œç¿»è½¬æŸ¥çœ‹å®Œæ•´ç®€ä»‹ã€‚</li>
                <li><strong>æ ‡ç­¾é¡µé¢„è§ˆ</strong>ï¼šç‚¹å‡»ä¹¦ç­¾å¡ç‰‡å¯åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€é“¾æ¥ï¼Œæ— éœ€ç¦»å¼€ä¹¦ç­¾ç®¡ç†å™¨é¡µé¢ã€‚</li>
                <li><strong>æ•°æ®å®‰å…¨</strong>ï¼šå®šæœŸå¯¼å‡ºä¸ºJSONæ ¼å¼å¹¶ä¿å­˜åˆ°å¤šä¸ªä½ç½®ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ã€‚å»ºè®®æ¯æœˆè‡³å°‘å¤‡ä»½ä¸€æ¬¡ã€‚</li>
                <li><strong>ä¼˜åŒ–æ€§èƒ½</strong>ï¼šå½“ä¹¦ç­¾æ•°é‡è¿‡å¤šæ—¶ï¼Œä½¿ç”¨åˆ†ç±»åŠŸèƒ½å°†ä¹¦ç­¾åˆ†æ•£åˆ°ä¸åŒåˆ†ç»„ï¼Œå¯æé«˜åŠ è½½å’Œæœç´¢é€Ÿåº¦ã€‚</li>
            </ul>
            
            <hr>

            <h4>æ•°æ®å­˜å‚¨è¯´æ˜</h4>
            <p>æœ¬å·¥å…·ä½¿ç”¨æµè§ˆå™¨çš„localStorageè¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
            <ul>
                <li>æ•°æ®ä»…å­˜å‚¨åœ¨æœ¬åœ°ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ï¼Œä¿éšœéšç§å®‰å…¨ã€‚</li>
                <li>ä¸åŒæµè§ˆå™¨ä¹‹é—´æ•°æ®ä¸å…±äº«ï¼Œæ›´æ¢æµè§ˆå™¨éœ€è¦é‡æ–°å¯¼å…¥ä¹¦ç­¾ã€‚</li>
                <li>æ¸…é™¤æµè§ˆå™¨ç¼“å­˜æˆ–éšç§æ•°æ®å¯èƒ½å¯¼è‡´å­˜å‚¨çš„æ•°æ®ä¸¢å¤±ã€‚</li>
                <li>å­˜å‚¨ç©ºé—´æœ‰é™ï¼Œå»ºè®®ä¹¦ç­¾æ•°é‡ä¸è¶…è¿‡1000æ¡ï¼Œä»¥å…å½±å“æ€§èƒ½ã€‚</li>
            </ul>
            
            <p><strong>localStorageå­˜å‚¨æ–¹å¼çš„ä¸»è¦ç¼ºç‚¹ï¼š</strong></p>
            <ul>
                <li><strong>å­˜å‚¨å®¹é‡æœ‰é™</strong>ï¼šé€šå¸¸æ¯ä¸ªåŸŸåä¸‹åªæœ‰çº¦5-10MBçš„å­˜å‚¨ç©ºé—´ï¼Œå¯¹äºå¤§é‡ä¹¦ç­¾æ•°æ®å¯èƒ½ä¸è¶³ã€‚</li>
                <li><strong>æ•°æ®æ˜“ä¸¢å¤±</strong>ï¼šæ¸…é™¤æµè§ˆå™¨ç¼“å­˜ã€å¸è½½æµè§ˆå™¨ã€ä½¿ç”¨éšç§æ¨¡å¼æˆ–æµè§ˆå™¨é‡ç½®éƒ½å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</li>
                <li><strong>è·¨æµè§ˆå™¨ä¸å…¼å®¹</strong>ï¼šæ•°æ®ä»…ä¿å­˜åœ¨å½“å‰ä½¿ç”¨çš„æµè§ˆå™¨ä¸­ï¼Œæ›´æ¢æµè§ˆå™¨æˆ–è®¾å¤‡éœ€è¦é‡æ–°å¯¼å…¥æ•°æ®ã€‚</li>
                <li><strong>ä»…æ”¯æŒå­—ç¬¦ä¸²æ ¼å¼</strong>ï¼šæ‰€æœ‰æ•°æ®å¿…é¡»åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²å­˜å‚¨ï¼Œå¤æ‚æ•°æ®ç»“æ„éœ€è¦é¢å¤–å¤„ç†ã€‚</li>
                <li><strong>å®‰å…¨æ€§é—®é¢˜</strong>ï¼šå­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„æ˜æ–‡æ•°æ®å¯èƒ½è¢«æ¶æ„è„šæœ¬è®¿é—®ï¼ˆå­˜åœ¨XSSé£é™©ï¼‰ã€‚</li>
                <li><strong>åŒæ­¥æ“ä½œé˜»å¡</strong>ï¼šè¯»å†™æ“ä½œæ˜¯åŒæ­¥çš„ï¼Œå¤§é‡æ•°æ®æ“ä½œå¯èƒ½é˜»å¡æµè§ˆå™¨ä¸»çº¿ç¨‹ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚</li>
                <li><strong>æ— è‡ªåŠ¨å¤‡ä»½æœºåˆ¶</strong>ï¼šæ•°æ®ä¸ä¼šè‡ªåŠ¨å¤‡ä»½ï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨å¯¼å‡ºä¿å­˜ã€‚</li>
                <li><strong>æ— è¿‡æœŸæœºåˆ¶</strong>ï¼šå­˜å‚¨çš„æ•°æ®ä¸ä¼šè‡ªåŠ¨è¿‡æœŸï¼Œéœ€è¦æ‰‹åŠ¨ç®¡ç†æ•°æ®ç”Ÿå‘½å‘¨æœŸã€‚</li>
            </ul>
            
            <p class="important-tip">æç¤ºï¼šä¸ºé¿å…æ•°æ®ä¸¢å¤±ï¼Œå»ºè®®æ‚¨å®šæœŸå¯¼å‡ºä¹¦ç­¾æ•°æ®å¹¶ä¿å­˜åˆ°å¤šä¸ªå®‰å…¨ä½ç½®ã€‚å»ºè®®æ¯æœˆè‡³å°‘å¤‡ä»½ä¸€æ¬¡ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿›è¡Œæµè§ˆå™¨å‡çº§æˆ–æ›´æ¢è®¾å¤‡å‰ã€‚</p>
        </div>
        <button onclick="hideHelpModal()">å…³é—­</button>
    </div>
    <div id="export-modal">
        <h3>å¯¼å‡ºä¹¦ç­¾å’Œç•™è¨€</h3>
        <div class="form-group">
            <label>æ–‡ä»¶å:</label>
            <input type="text" id="export-filename" placeholder="bookmarks_YYYY.MM.DD">
        </div>
        <button onclick="exportBookmarks('json')">å¯¼å‡ºä¸º JSON (æ¨èï¼Œå®Œæ•´å¤‡ä»½å«ä¹¦ç­¾å’Œç•™è¨€)</button>
        <button onclick="exportBookmarks('txt')">å¯¼å‡ºä¸º TXT (ä»…ä¹¦ç­¾å’Œç•™è¨€ï¼Œé€‚åˆé˜…è¯»)</button>
        <button onclick="exportBookmarks('html')">å¯¼å‡ºä¸º HTML (ä»…ä¹¦ç­¾ï¼Œå¯å¯¼å…¥æµè§ˆå™¨)</button>
        <p class="export-tips">æç¤ºï¼šæ–‡ä»¶å°†ä¿å­˜åˆ°æ‚¨çš„ä¸‹è½½ç›®å½•ã€‚å»ºè®®ä½¿ç”¨ JSON æ ¼å¼è¿›è¡Œå®Œæ•´å¤‡ä»½ï¼ŒHTML é€‚åˆä¸æµè§ˆå™¨å…±äº«ï¼ŒTXT ä¾¿äºæŸ¥çœ‹ä½†ä¸æ”¯æŒå¯¼å…¥ã€‚</p>
    </div>
    <div id="sort-modal">
        <h3>ä¹¦ç­¾æ’åº</h3>
        <button onclick="applySort('added-desc')">æŒ‰æ·»åŠ æ—¥æœŸï¼ˆæ–°åˆ°æ—§ï¼‰</button>
        <button onclick="applySort('added-asc')">æŒ‰æ·»åŠ æ—¥æœŸï¼ˆæ—§åˆ°æ–°ï¼‰</button>
        <button onclick="applySort('title-asc')">æŒ‰æ ‡é¢˜ï¼ˆA-Zï¼‰</button>
        <button onclick="applySort('title-desc')">æŒ‰æ ‡é¢˜ï¼ˆZ-Aï¼‰</button>
        <button onclick="hideSortModal()">âŒ å…³é—­</button>
    </div>
    <div id="add-form">
        <h3>æ·»åŠ /ç¼–è¾‘ä¹¦ç­¾</h3>
        <div class="form-group">
            <label>åç§°:</label>
            <input type="text" id="name" placeholder="è¯·è¾“å…¥ä¹¦ç­¾åç§°">
        </div>
        <div class="form-group">
            <label>é“¾æ¥:</label>
            <input type="text" id="url" placeholder="è¯·è¾“å…¥é“¾æ¥ (å¯é€‰ï¼Œå¦‚ https://example.com)">
        </div>
        <div class="form-group">
            <label>ç®€ä»‹:</label>
            <textarea id="desc" placeholder="è¯·è¾“å…¥ç®€ä»‹ï¼ˆå¯é€‰ï¼‰"></textarea>
        </div>
        <div class="form-group">
            <label>åˆ†ç±»:</label>
            <input type="text" id="category" list="category-list" placeholder="è¾“å…¥æˆ–é€‰æ‹©åˆ†ç±»">
            <datalist id="category-list"></datalist>
        </div>
        <div class="form-buttons">
            <button onclick="saveBookmark()">ğŸ’¾ ä¿å­˜</button>
            <button onclick="toggleAddForm(false)">âŒ å–æ¶ˆ</button>
        </div>
    </div>
    <div id="message-form">
        <h3>ç•™è¨€æ¿</h3>
        <p class="message-instructions">æç¤ºï¼šåŒå‡»ä¸‹æ–¹æ–‡æœ¬åŒºåŸŸå³å¯ç¼–è¾‘ç•™è¨€ï¼Œä¿å­˜åå¯åœ¨ä¸‹æ¬¡æ‰“å¼€æ—¶æŸ¥çœ‹ã€‚æ‰€æœ‰ç•™è¨€å­˜å‚¨åœ¨æœ¬åœ°ï¼Œå®šæœŸå¯¼å‡ºå¤‡ä»½ä»¥é˜²ä¸¢å¤±ã€‚</p>
        <div class="form-group">
            <label>ç•™è¨€å†…å®¹</label>
            <textarea id="message-input" placeholder="åŒå‡»æ­¤å¤„ç¼–è¾‘ç•™è¨€..." readonly></textarea>
        </div>
        <div class="form-buttons">
            <button id="save-message-btn" onclick="saveMessage()">ä¿å­˜</button>
            <button id="cancel-message-btn" onclick="cancelMessageEdit()">å–æ¶ˆ</button>
            <button id="close-message-btn" onclick="hideAllModals()">âŒ å…³é—­</button>
        </div>
    </div>
    <div id="welcome-modal">
        <h3>æ¬¢è¿ä½¿ç”¨ä¹¦ç­¾ç®¡ç†å™¨</h3>
        <div id="welcome-content">
            <p>è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ç¦»çº¿ä¹¦ç­¾ç®¡ç†å·¥å…·ï¼Œå¸®åŠ©æ‚¨é«˜æ•ˆæ•´ç†ã€æœç´¢å’Œåˆ†äº«ä¹¦ç­¾å’Œç•™è¨€ï¼Œéšæ—¶éšåœ°ä½¿ç”¨ï¼Œæ— éœ€è”ç½‘ã€‚</p>
            <div class="step">
                <strong>å¼€å§‹ä½¿ç”¨ï¼š</strong> ç‚¹å‡»é¡¶éƒ¨å·¥å…·æ çš„â€œâ• æ·»åŠ ä¹¦ç­¾â€åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªä¹¦ç­¾ï¼Œæˆ–é€šè¿‡â€œğŸ“¥ å¯¼å…¥ä¹¦ç­¾â€åŠ è½½å·²æœ‰æ•°æ®ã€‚
            </div>
            <div class="step">
                <strong>æ‹–æ‹½æ’åºï¼š</strong> æ”¯æŒä¹¦ç­¾å’Œåˆ†ç±»çš„æ‹–æ‹½äº¤æ¢ä½ç½®ï¼Œæ‹–åˆ°å¡ç‰‡é™„è¿‘ä¼šæ˜¾ç¤ºè“è‰²è™šçº¿æç¤ºæ¡†ï¼Œæ¾å¼€å³å¯å®Œæˆäº¤æ¢ã€‚
            </div>
            <div class="step">
                <strong>æœç´¢åŠŸèƒ½ï¼š</strong> ä½¿ç”¨é¡¶éƒ¨æœç´¢æ¡†å¿«é€ŸæŸ¥æ‰¾ä¹¦ç­¾ï¼Œæ”¯æŒåç§°ã€URLå’Œæè¿°çš„æ¨¡ç³Šæœç´¢ã€‚
            </div>
            <div class="step">
                <strong>æ•°æ®ç®¡ç†ï¼š</strong> æ”¯æŒç¼–è¾‘ã€åˆ é™¤ã€åˆ†ç±»ç®¡ç†ä»¥åŠç•™è¨€æ¿åŠŸèƒ½ï¼Œæ•°æ®å¯å¯¼å‡ºä¸º JSONã€TXT æˆ– HTML æ ¼å¼ã€‚
            </div>
            <div class="step">
                <strong>é”®ç›˜å¿«æ·é”®ï¼š</strong> ä½¿ç”¨ Ctrl+S å¿«é€Ÿæ·»åŠ ä¹¦ç­¾ï¼Œåœ¨ç¼–è¾‘æ¨¡å¼ä¸‹æŒ‰ Enter ä¿å­˜æ›´æ”¹ã€‚
            </div>
            <div class="step">
                <strong>æ•°æ®å®‰å…¨ï¼š</strong> æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ï¼Œè¯·å®šæœŸé€šè¿‡â€œğŸ“¤ å¯¼å‡ºä¹¦ç­¾â€å¤‡ä»½ï¼Œé˜²æ­¢å› æ¸…ç©ºç¼“å­˜ä¸¢å¤±ã€‚
            </div>
            <div class="step">
                <strong>å¯¼å…¥å¯¼å‡ºï¼š</strong> HTML æ ¼å¼å¯ç›´æ¥å¯¼å…¥æµè§ˆå™¨ï¼ŒJSON æ ¼å¼é€‚åˆå®Œæ•´å¤‡ä»½ï¼ŒTXT æ ¼å¼ä¾¿äºæŸ¥çœ‹ã€‚
            </div>
        </div>
        <div class="form-buttons">
            <button onclick="hideWelcomeModal()">æˆ‘çŸ¥é“å•¦</button>
        </div>
    </div>

    <script>
        const state = {
                bookmarks: [],
                message: '',
                lastDeletedBookmark: null,
                lastDeletedIndex: null,
                filteredBookmarks: [],
                selectedCategory: 'å…¨éƒ¨ä¹¦ç­¾',
                editingIndex: null,
                isEditMode: false,
                selectedBookmarks: [],
                currentPage: 1,
                isFirstRun: !localStorage.getItem('hasRunBefore'),
                categories: new Set(['å…¨éƒ¨ä¹¦ç­¾']),
                isRendering: false,
                isImporting: false
        };

        const MAX_BOOKMARKS = 1000;
        const MAX_STORAGE_SIZE = 4 * 1024 * 1024;

        function initializeBookmarkBackgrounds() {
                let updated = false;
                state.bookmarks.forEach(bookmark => {
                        if (!bookmark.background) {
                                bookmark.background = getRandomGradient();
                                updated = true;
                        }
                });
                if (updated) {
                        saveToLocalStorageImmediately();
                }
        }

        // é˜²æŠ–å¤„ç†çš„æœ¬åœ°å­˜å‚¨ä¿å­˜å‡½æ•°
        let saveTimeout;
        let pendingSaveData = null;
        
        // åŸå§‹ä¿å­˜å‡½æ•°ï¼Œå®é™…æ‰§è¡ŒlocalStorageå†™å…¥
        function _saveToLocalStorageInternal() {
                try {
                        // ä½¿ç”¨pendingSaveDataï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œå¦åˆ™ä½¿ç”¨å½“å‰state
                        const data = pendingSaveData || {
                                bookmarks: state.bookmarks,
                                message: state.message
                        };
                        
                        // é‡ç½®å¾…ä¿å­˜æ•°æ®
                        pendingSaveData = null;
                        
                        const serializedData = JSON.stringify(data);
                        if (serializedData.length > MAX_STORAGE_SIZE) {
                                alert('æ•°æ®é‡è¿‡å¤§ï¼Œæ— æ³•ä¿å­˜ã€‚è¯·åˆ é™¤éƒ¨åˆ†ä¹¦ç­¾æˆ–ç•™è¨€åå†è¯•ã€‚');
                                return false;
                        }
                        
                        localStorage.setItem('bookmarkData', serializedData);
                        return true;
                } catch (e) {
                        console.error('ä¿å­˜æ•°æ®å¤±è´¥ï¼š', e);
                        alert('ä¿å­˜æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å­˜å‚¨ç©ºé—´æˆ–æƒé™ã€‚');
                        return false;
                }
        }
        
        // å…¬å…±APIå‡½æ•°ï¼Œå¸¦é˜²æŠ–å¤„ç†
        function saveToLocalStorage() {
                // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
                if (saveTimeout) {
                        clearTimeout(saveTimeout);
                }
                
                // è®¾ç½®æ–°çš„å®šæ—¶å™¨ï¼Œå»¶è¿Ÿæ‰§è¡Œä¿å­˜æ“ä½œ
                // æ³¨æ„ï¼šè¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ç°åœ¨åªè¡¨ç¤ºä¿å­˜æ“ä½œå·²è¢«è°ƒåº¦ï¼Œè€Œä¸æ˜¯å®é™…ä¿å­˜æˆåŠŸ
                // å®é™…ä¿å­˜ç»“æœéœ€è¦åœ¨å›è°ƒä¸­å¤„ç†ï¼Œä½†ä¸ºäº†å…¼å®¹ç°æœ‰ä»£ç ï¼Œæˆ‘ä»¬æš‚æ—¶è¿”å›true
                saveTimeout = setTimeout(() => {
                        _saveToLocalStorageInternal();
                }, 200); // 200æ¯«ç§’é˜²æŠ–å»¶è¿Ÿ
                
                return true;
        }
        
        // ç«‹å³ä¿å­˜å‡½æ•°ï¼ˆç”¨äºéœ€è¦ç«‹å³æŒä¹…åŒ–çš„æ“ä½œï¼‰
        function saveToLocalStorageImmediately() {
                if (saveTimeout) {
                        clearTimeout(saveTimeout);
                }
                return _saveToLocalStorageInternal();
        }

        function loadBookmarks() {
                const loadingIndicator = document.getElementById('loading-indicator');
                if (loadingIndicator) loadingIndicator.style.display = 'block';

                try {
                        // æ£€æŸ¥localStorageæ˜¯å¦å¯ç”¨
                        if (typeof localStorage === 'undefined') {
                                throw new Error('æµè§ˆå™¨ä¸æ”¯æŒæœ¬åœ°å­˜å‚¨');
                        }
                        
                        // æ£€æŸ¥localStorageæ˜¯å¦è¢«ç¦ç”¨
                        try {
                                localStorage.setItem('test_storage', 'test');
                                localStorage.removeItem('test_storage');
                        } catch (storageError) {
                                throw new Error('æœ¬åœ°å­˜å‚¨åŠŸèƒ½è¢«ç¦ç”¨ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®');
                        }
                        
                        const storedData = localStorage.getItem('bookmarkData');
                        if (!storedData) {
                                console.log('æ²¡æœ‰æ‰¾åˆ°å­˜å‚¨çš„ä¹¦ç­¾æ•°æ®ï¼Œåˆå§‹åŒ–ç©ºä¹¦ç­¾åˆ—è¡¨');
                                state.bookmarks = [];
                                state.message = '';
                        } else {
                                try {
                                        const data = JSON.parse(storedData);
                                        if (!data || typeof data !== 'object') {
                                                throw new Error('å­˜å‚¨æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                                        }
                                        state.bookmarks = Array.isArray(data.bookmarks) ? data.bookmarks.map(b => ({
                                                name: b.name || 'æœªå‘½å',
                                                url: b.url || '',
                                                desc: b.desc || '',
                                                category: b.category || 'é»˜è®¤åˆ†ç»„',
                                                background: b.background || getRandomGradient(),
                                                added: b.added || Date.now()
                                        })) : [];
                                        state.message = typeof data.message === 'string' ? data.message : '';
                                } catch (parseError) {
                                        console.warn('è§£æå­˜å‚¨æ•°æ®æ—¶å‡ºé”™ï¼Œå°è¯•ä¿®å¤...', parseError);
                                        // å°è¯•ä»æŸåçš„JSONä¸­æ¢å¤éƒ¨åˆ†æ•°æ®
                                        try {
                                                // æ›´å®½æ¾çš„è§£æç­–ç•¥ - å°è¯•æå–æœ‰æ•ˆçš„bookmarksæ•°ç»„
                                                const partialMatch = storedData.match(/"bookmarks"\s*:\s*\[([\s\S]*?)\]/);
                                                if (partialMatch && partialMatch[1]) {
                                                        try {
                                                                // å°è¯•è§£æbookmarksæ•°ç»„éƒ¨åˆ†
                                                                const partialBookmarks = JSON.parse(`[${partialMatch[1]}]`);
                                                                if (Array.isArray(partialBookmarks)) {
                                                                        state.bookmarks = partialBookmarks.map(b => ({
                                                                                name: b.name || 'æœªå‘½å',
                                                                                url: b.url || '',
                                                                                desc: b.desc || '',
                                                                                category: b.category || 'é»˜è®¤åˆ†ç»„',
                                                                                background: b.background || getRandomGradient(),
                                                                                added: b.added || Date.now()
                                                                        }));
                                                                        console.info('å·²æˆåŠŸæ¢å¤éƒ¨åˆ†ä¹¦ç­¾æ•°æ®');
                                                                }
                                                        } catch (partialError) {
                                                                console.error('æ— æ³•æ¢å¤éƒ¨åˆ†æ•°æ®:', partialError);
                                                                state.bookmarks = [];
                                                                state.message = '';
                                                        }
                                                } else {
                                                        throw new Error('æ— æ³•æå–æœ‰æ•ˆæ•°æ®');
                                                }
                                        } catch (recoveryError) {
                                                console.error('æ•°æ®æ¢å¤å¤±è´¥:', recoveryError);
                                                state.bookmarks = [];
                                                state.message = '';
                                        }
                                }
                        }
                        
                        // ç¡®ä¿æ•°æ®å®Œæ•´æ€§
                        if (!Array.isArray(state.bookmarks)) {
                                console.warn('ä¹¦ç­¾æ•°æ®æ ¼å¼å¼‚å¸¸ï¼Œé‡ç½®ä¸ºç©ºæ•°ç»„');
                                state.bookmarks = [];
                        }
                        
                        initializeBookmarkBackgrounds();
                        updateCategoryFilter();
                        filterBookmarks();
                        renderCategories();
                        renderBookmarks();
                } catch (e) {
                        console.error('åŠ è½½æ•°æ®å¤±è´¥ï¼š', e);
                        state.bookmarks = [];
                        state.message = '';
                        alert('åŠ è½½ä¹¦ç­¾å¤±è´¥ï¼Œå·²é‡ç½®ä¸ºç©ºã€‚è¯·æ£€æŸ¥å­˜å‚¨æ•°æ®æˆ–å¯¼å…¥å¤‡ä»½ã€‚');
                } finally {
                        if (loadingIndicator) loadingIndicator.style.display = 'none';
                }
        }

        // ä¼˜åŒ–çš„é˜²æŠ–å‡½æ•°å®ç°ï¼Œç¡®ä¿æ­£ç¡®æ¸…ç†å®šæ—¶å™¨å¹¶é¿å…é—­åŒ…é™·é˜±
        function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                        const later = () => {
                                clearTimeout(timeout);
                                func.apply(this, args);
                        };
                        clearTimeout(timeout);
                        timeout = setTimeout(later, wait);
                };
        }

        function getRandomGradient() {
                const colors = [
                        '#FFD1DC', '#B9E4C9', '#C9E4FF', '#FFF3B0', '#E6D7FF'
                ];
                const angle = Math.floor(Math.random() * 360);
                const color1 = colors[Math.floor(Math.random() * colors.length)];
                let color2 = colors[Math.floor(Math.random() * colors.length)];
                while (color2 === color1) {
                        color2 = colors[Math.floor(Math.random() * colors.length)];
                }
                return `linear-gradient(${angle}deg, ${color1}, ${color2})`;
        }

        function getCategoryColor(category) {
                const colors = [
                        '#FFE4E6', '#DCEBFF', '#E0FFD9', '#FFF2DF', '#F2EFFF', // æµ…è‰²è°ƒæ•´
                        '#FDF6C8', '#F4E3FF', '#E3F5F8', '#FFDDDD', '#E8E8E8'
                ];
                const index = category.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0) % colors.length;
                return colors[index];
        }

        function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
        }

        function showModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                        modal.style.display = 'block';
                        document.getElementById('overlay').style.display = 'block';
                }
        }

        function hideModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                        modal.style.display = 'none';
                        document.getElementById('overlay').style.display = 'none';
                }
        }

        function hideAllModals() {
                const modals = [
                        'add-form', 'view-bookmark-modal', 'help-modal', 'export-modal',
                        'sort-modal', 'message-form', 'welcome-modal'
                ];
                modals.forEach(modalId => hideModal(modalId));
                toggleEditMode(false);
        }

        function toggleAddForm(show) {
                const form = document.getElementById('add-form');
                const nameInput = document.getElementById('name');
                const urlInput = document.getElementById('url');
                const descInput = document.getElementById('desc');
                const categoryInput = document.getElementById('category');
                if (show) {
                        form.style.display = 'block';
                        document.getElementById('overlay').style.display = 'block';
                        nameInput.focus();
                        if (state.editingIndex === null) {
                                nameInput.value = '';
                                urlInput.value = '';
                                descInput.value = '';
                                categoryInput.value = '';
                        }
                        updateCategoryDatalist();
                } else {
                        hideModal('add-form');
                        state.editingIndex = null;
                }
        }

        function updateCategoryDatalist() {
                const datalist = document.getElementById('category-list');
                datalist.innerHTML = '';
                state.categories.forEach(category => {
                        if (category && category !== 'å…¨éƒ¨ä¹¦ç­¾') {
                                const option = document.createElement('option');
                                option.value = category;
                                datalist.appendChild(option);
                        }
                });
        }

        function saveBookmark() {
                const nameInput = document.getElementById('name');
                const urlInput = document.getElementById('url');
                const descInput = document.getElementById('desc');
                const categoryInput = document.getElementById('category');
                if (!nameInput || !urlInput) return;

                const name = nameInput.value.trim();
                const url = urlInput.value.trim();
                const desc = descInput.value.trim();
                const category = categoryInput.value.trim();

                if (!name) {
                        alert('è¯·å¡«å†™ä¹¦ç­¾åç§°');
                        return;
                }
                
                // åŸºæœ¬URLéªŒè¯
                if (url && !url.match(/^https?:\/\//) && !url.match(/^about:/) && !url.match(/^chrome:/)) {
                        // å¦‚æœURLä¸ä»¥http/httpså¼€å¤´ï¼Œæ·»åŠ http://
                        alert('è¯·å¡«å†™æœ‰æ•ˆçš„URLï¼Œå»ºè®®ä»¥http://æˆ–https://å¼€å¤´');
                        return;
                }

                const bookmark = {
                        name,
                        url,
                        desc,
                        category: category || 'é»˜è®¤åˆ†ç»„',
                        background: getRandomGradient(),
                        added: Date.now()
                };

                if (state.editingIndex !== null && state.editingIndex < state.filteredBookmarks.length) {
                        const globalIndex = state.bookmarks.indexOf(state.filteredBookmarks[state.editingIndex]);
                        if (globalIndex !== -1) {
                                bookmark.background = state.bookmarks[globalIndex].background;
                                bookmark.added = state.bookmarks[globalIndex].added;
                                state.bookmarks[globalIndex] = bookmark;
                        }
                } else {
                        state.bookmarks.push(bookmark);
                }

                if (saveToLocalStorageImmediately()) {
                        filterBookmarks();
                        renderBookmarks();
                        renderCategories(); // æ·»åŠ æ­¤è¡Œï¼Œç¡®ä¿ä¾§è¾¹æ æ›´æ–°
                        toggleAddForm(false);
                        nameInput.value = '';
                        urlInput.value = '';
                        descInput.value = '';
                        categoryInput.value = '';
                        state.editingIndex = null;
                }
        }

        function editBookmark(index) {
                if (index < 0 || index >= state.filteredBookmarks.length) return;
                state.editingIndex = index;
                const bookmark = state.filteredBookmarks[index];
                document.getElementById('name').value = bookmark.name;
                document.getElementById('url').value = bookmark.url;
                document.getElementById('desc').value = bookmark.desc;
                document.getElementById('category').value = bookmark.category;
                toggleAddForm(true);
        }

        function deleteBookmark(index) {
                if (index < 0 || index >= state.filteredBookmarks.length) return;
                state.lastDeletedBookmark = { ...state.filteredBookmarks[index] };
                state.lastDeletedIndex = state.bookmarks.indexOf(state.filteredBookmarks[index]);
                state.bookmarks.splice(state.lastDeletedIndex, 1);
                if (saveToLocalStorageImmediately()) {
                        filterBookmarks();
                        renderBookmarks();
                        renderCategories();
                        toggleEditMode(true); // æ·»åŠ æ­¤è¡Œï¼Œä¿æŒç¼–è¾‘æ¨¡å¼æŒ‰é’®çŠ¶æ€
                        document.getElementById('undo-btn').style.display = 'inline-flex';
                }
        }

        function deletePageBookmarks() {
                if (!confirm('ç¡®å®šè¦åˆ é™¤æœ¬é¡µæ‰€æœ‰ä¹¦ç­¾å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) return;
                const itemsPerPage = getItemsPerPage();
                const startIndex = (state.currentPage - 1) * itemsPerPage;
                const endIndex = Math.min(startIndex + itemsPerPage, state.filteredBookmarks.length);
                const bookmarksToDelete = state.filteredBookmarks.slice(startIndex, endIndex);
                bookmarksToDelete.forEach(bookmark => {
                        const globalIndex = state.bookmarks.indexOf(bookmark);
                        if (globalIndex !== -1) {
                                state.bookmarks.splice(globalIndex, 1);
                        }
                });
                if (saveToLocalStorageImmediately()) {
                        state.currentPage = 1;
                        filterBookmarks();
                        renderBookmarks();
                        renderCategories(); // æ·»åŠ æ­¤è¡Œï¼Œç¡®ä¿ä¾§è¾¹æ æ›´æ–°
                }
        }

        function batchDeleteBookmarks() {
                if (state.selectedBookmarks.length === 0) {
                        alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„ä¹¦ç­¾ï¼');
                        return;
                }
                if (!confirm(`ç¡®å®šè¦åˆ é™¤ ${state.selectedBookmarks.length} ä¸ªé€‰ä¸­çš„ä¹¦ç­¾å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)) return;
                state.selectedBookmarks.sort((a, b) => b - a).forEach(index => {
                        state.bookmarks.splice(index, 1);
                });
                state.selectedBookmarks = [];
                if (saveToLocalStorageImmediately()) {
                        filterBookmarks();
                        renderBookmarks();
                        renderCategories(); // æ·»åŠ æ­¤è¡Œï¼Œç¡®ä¿ä¾§è¾¹æ æ›´æ–°
                        toggleEditMode(false);
                }
        }

        function undoDelete() {
                if (state.lastDeletedBookmark && state.lastDeletedIndex !== null) {
                        state.bookmarks.splice(state.lastDeletedIndex, 0, state.lastDeletedBookmark);
                        if (saveToLocalStorageImmediately()) {
                                filterBookmarks();
                                renderBookmarks();
                                state.lastDeletedBookmark = null;
                                state.lastDeletedIndex = null;
                                document.getElementById('undo-btn').style.display = 'none';
                        }
                }
        }

        // åˆå§‹åŒ–ä¸‹æ‹‰èœå•åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
                // è·å–æ‰€æœ‰ä¸‹æ‹‰èœå•æŒ‰é’®
                const dropdownBtns = document.querySelectorAll('.dropdown .dropbtn');
                
                // ä¸ºæ¯ä¸ªæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
                dropdownBtns.forEach(btn => {
                        btn.addEventListener('click', function(e) {
                                e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
                                const dropdown = this.closest('.dropdown');
                                const isOpen = dropdown.classList.contains('open');
                                 
                                // å…³é—­æ‰€æœ‰å…¶ä»–æ‰“å¼€çš„èœå•
                                document.querySelectorAll('.dropdown.open').forEach(el => {
                                        el.classList.remove('open');
                                });
                                 
                                // å¦‚æœå½“å‰èœå•æ²¡æ‰“å¼€ï¼Œåˆ™æ‰“å¼€å®ƒ
                                if (!isOpen) {
                                        dropdown.classList.add('open');
                                }
                        });
                });
                
                // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­æ‰€æœ‰èœå•
                document.addEventListener('click', function() {
                        document.querySelectorAll('.dropdown.open').forEach(dropdown => {
                                dropdown.classList.remove('open');
                        });
                });
                
                // ç§»é™¤ä¸‹æ‹‰èœå•å†…å®¹åŒºåŸŸçš„è‡ªåŠ¨å…³é—­è¡Œä¸ºï¼Œè®©åŠŸèƒ½æ“ä½œå®Œæˆåå†å…³é—­
                // (å„åŠŸèƒ½æŒ‰é’®ä¼šåœ¨æ‰§è¡Œå®Œæ“ä½œåè‡ªè¡Œå¤„ç†èœå•çŠ¶æ€)
        });
        
        function toggleEditMode(forceState = null) {
                const isEditMode = forceState !== null ? forceState : !state.isEditMode;
                state.isEditMode = isEditMode;
                state.selectedBookmarks = [];
                document.getElementById('edit-mode-btn').style.display = isEditMode ? 'none' : 'block';
                document.getElementById('done-btn').style.display = isEditMode ? 'block' : 'none';
                document.getElementById('batch-delete-btn').style.display = 'none';
                // ç¡®ä¿åˆ é™¤æœ¬é¡µä¹¦ç­¾æŒ‰é’®å§‹ç»ˆå¯è§
                document.getElementById('delete-page-btn').style.display = 'block';
                const cards = document.querySelectorAll('.bookmark-card');
                cards.forEach(card => {
                        card.classList.toggle('edit-mode', isEditMode);
                        card.draggable = !isEditMode;
                        const mainCard = card.querySelector('.main-card');
                        if (mainCard) {
                                mainCard.classList.remove('flipped');
                        }
                });
                const actionBars = document.querySelectorAll('.action-bar .action-buttons');
                actionBars.forEach(bar => {
                        bar.style.display = isEditMode ? 'flex' : 'none';
                });
                const checkboxes = document.querySelectorAll('.bookmark-checkbox');
                checkboxes.forEach(checkbox => {
                        checkbox.checked = false;
                        checkbox.classList.toggle('visible', isEditMode);
                });
                
                // å…³é—­æ‰€æœ‰ä¸‹æ‹‰èœå•
                document.querySelectorAll('.dropdown.open').forEach(dropdown => {
                        dropdown.classList.remove('open');
                });
        }

        function toggleBookmarkSelection(globalIndex, isSelected) {
                if (isSelected) {
                        if (!state.selectedBookmarks.includes(globalIndex)) {
                                state.selectedBookmarks.push(globalIndex);
                        }
                } else {
                        state.selectedBookmarks = state.selectedBookmarks.filter(index => index !== globalIndex);
                }
                
                // æ ¹æ®é€‰ä¸­ä¹¦ç­¾çš„æ•°é‡åˆ‡æ¢å®ŒæˆæŒ‰é’®å’Œæ‰¹é‡åˆ é™¤æŒ‰é’®
                if (state.isEditMode) {
                    if (state.selectedBookmarks.length > 0) {
                        document.getElementById('done-btn').style.display = 'none';
                        document.getElementById('batch-delete-btn').style.display = 'block';
                    } else {
                        document.getElementById('done-btn').style.display = 'block';
                        document.getElementById('batch-delete-btn').style.display = 'none';
                    }
                }
        }

        function showBookmarkDetails(index) {
                if (index < 0 || index >= state.filteredBookmarks.length) return;
                const bookmark = state.filteredBookmarks[index];
                const details = document.getElementById('bookmark-details');
                const descText = bookmark.desc && bookmark.desc.trim() ? escapeHtml(bookmark.desc) : 'æš‚æ— ç®€ä»‹';
                details.innerHTML = `
                        <div class="form-group"><label>åç§°:</label><p>${escapeHtml(bookmark.name)}</p></div>
                        <div class="form-group"><label>é“¾æ¥:</label><p><a href="${escapeHtml(bookmark.url)}" target="_blank">${escapeHtml(bookmark.url)}</a></p></div>
                        <div class="form-group"><label>ç®€ä»‹:</label><p>${descText}</p></div>
                        <div class="form-group"><label>åˆ†ç±»:</label><p>${escapeHtml(bookmark.category)}</p></div>
                        <div class="form-group"><label>æ·»åŠ æ—¶é—´:</label><p>${new Date(bookmark.added).toLocaleString()}</p></div>
                `;
                showModal('view-bookmark-modal');
        }

        function hideBookmarkModal() {
                hideModal('view-bookmark-modal');
        }

        function showExportModal() {
                const now = new Date();
                const dateStr = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')}`;
                document.getElementById('export-filename').value = `bookmarks_${dateStr}`;
                showModal('export-modal');
        }

        function exportBookmarks(format) {
                let filename = document.getElementById('export-filename').value.trim();
                if (!filename) {
                        const now = new Date();
                        const dateStr = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')}`;
                        filename = `bookmarks_${dateStr}`;
                }
                filename = filename.replace(/[^a-zA-Z0-9._-]/g, '_');

                let content, mimeType, extension;
                if (format === 'json') {
                        const data = { bookmarks: state.bookmarks, message: state.message };
                        content = JSON.stringify(data, null, 2);
                        mimeType = 'application/json';
                        extension = 'json';
                } else if (format === 'txt') {
                        content = `ä¹¦ç­¾ç®¡ç†å™¨å¯¼å‡ºæ–‡ä»¶ (${new Date().toLocaleString()})\n\n`;
                        content += `=== ç•™è¨€ ===\n${state.message || 'æ— ç•™è¨€'}\n\n`;
                        content += `=== ä¹¦ç­¾ ===\n`;
                        state.bookmarks.forEach((bookmark, index) => {
                                content += `\nä¹¦ç­¾ ${index + 1}:\n`;
                                content += `åç§°: ${bookmark.name}\n`;
                                content += `é“¾æ¥: ${bookmark.url}\n`;
                                content += `ç®€ä»‹: ${bookmark.desc || 'æ— '}\n`;
                                content += `åˆ†ç±»: ${bookmark.category}\n`;
                                content += `æ·»åŠ æ—¶é—´: ${new Date(bookmark.added).toLocaleString()}\n`;
                        });
                        mimeType = 'text/plain';
                        extension = 'txt';
                } else if (format === 'html') {
                        content = `<!DOCTYPE NETSCAPE-Bookmark-file-1>
<!-- This is an automatically generated bookmark file -->
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Bookmarks</TITLE>
</HEAD>
<BODY>
<H1>Bookmarks</H1>
<DL><p>`;
                        const categories = [...new Set(state.bookmarks.map(b => b.category))];
                        categories.forEach(category => {
                                content += `
        <DT><H3>${escapeHtml(category)}</H3>
        <DL><p>`;
                                state.bookmarks.filter(b => b.category === category).forEach(bookmark => {
                                        content += `
                <DT><A HREF="${escapeHtml(bookmark.url)}">${escapeHtml(bookmark.name)}</A>
                <DD>${escapeHtml(bookmark.desc || '')}`;
                                });
                                content += `
        </DL><p>`;
                        });
                        content += `
</DL><p>
</BODY>
</HTML>`;
                        mimeType = 'text/html';
                        extension = 'html';
                } else {
                        alert('ä¸æ”¯æŒçš„å¯¼å‡ºæ ¼å¼');
                        return;
                }

                // æ·»åŠ å¯¼å‡ºç¡®è®¤æç¤º
                if (!confirm(`ç¡®å®šè¦å¯¼å‡ºä¹¦ç­¾ä¸º ${filename}.${extension} å—ï¼Ÿæ–‡ä»¶å°†ä¿å­˜åˆ°æ‚¨çš„é»˜è®¤ä¸‹è½½ç›®å½•ã€‚`)) {
                        return; // ç”¨æˆ·å–æ¶ˆå¯¼å‡º
                }

                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${filename}.${extension}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                hideModal('export-modal');
        }

        function importBookmarks(event) {
                // æ·»åŠ eventå¯¹è±¡å­˜åœ¨æ€§æ£€æŸ¥
                if (!event || !event.target) {
                        alert('å¯¼å…¥å¤±è´¥ï¼šæ— æ³•è·å–æ–‡ä»¶è¾“å…¥ä¿¡æ¯');
                        return;
                }
                
                if (state.isImporting) return;
                state.isImporting = true;

                const file = event.target.files[0];
                if (!file) {
                        state.isImporting = false;
                        return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                        try {
                                const content = e.target.result;
                                let importedData = { bookmarks: [], message: '' };

                                if (file.name.endsWith('.json')) {
                                        importedData = JSON.parse(content);
                                        if (!importedData || !Array.isArray(importedData.bookmarks)) {
                                                throw new Error('æ— æ•ˆçš„ JSON æ–‡ä»¶æ ¼å¼');
                                        }
                                } else if (file.name.endsWith('.txt')) {
                                        const lines = content.split('\n').map(line => line.trim());
                                        let currentBookmark = null;
                                        let messageSection = false;

                                        for (const line of lines) {
                                                if (!line) continue; // è·³è¿‡ç©ºè¡Œ
                                                if (line.startsWith('=== ç•™è¨€ ===')) {
                                                        messageSection = true;
                                                        importedData.message = '';
                                                        continue;
                                                }
                                                if (line.startsWith('=== ä¹¦ç­¾ ===')) {
                                                        messageSection = false;
                                                        continue;
                                                }
                                                if (messageSection) {
                                                        importedData.message += (importedData.message ? '\n' : '') + line;
                                                        continue;
                                                }

                                                if (line.match(/^ä¹¦ç­¾ \d+:$/)) {
                                                        if (currentBookmark) {
                                                                // éªŒè¯å¹¶ä¿å­˜ä¸Šä¸€æ¡ä¹¦ç­¾
                                                                if (currentBookmark.name && currentBookmark.url) {
                                                                        importedData.bookmarks.push(currentBookmark);
                                                                }
                                                        }
                                                        currentBookmark = {};
                                                        continue;
                                                }
                                                if (currentBookmark) {
                                                        if (line.startsWith('åç§°:')) {
                                                                currentBookmark.name = line.replace('åç§°:', '').trim() || 'æœªå‘½å';
                                                        } else if (line.startsWith('é“¾æ¥:')) {
                                                                currentBookmark.url = line.replace('é“¾æ¥:', '').trim() || '';
                                                        } else if (line.startsWith('ç®€ä»‹:')) {
                                                                currentBookmark.desc = line.replace('ç®€ä»‹:', '').trim() === 'æ— ' ? '' : line.replace('ç®€ä»‹:', '').trim();
                                                        } else if (line.startsWith('åˆ†ç±»:')) {
                                                                currentBookmark.category = line.replace('åˆ†ç±»:', '').trim() || 'é»˜è®¤åˆ†ç»„';
                                                        } else if (line.startsWith('æ·»åŠ æ—¶é—´:')) {
                                                                currentBookmark.added = new Date(line.replace('æ·»åŠ æ—¶é—´:', '').trim()).getTime() || Date.now();
                                                        }
                                                }
                                        }
                                        // å¤„ç†æœ€åä¸€æ¡ä¹¦ç­¾
                                        if (currentBookmark && currentBookmark.name && currentBookmark.url) {
                                                importedData.bookmarks.push(currentBookmark);
                                        }
                                } else if (file.name.endsWith('.html')) {
                                        try {
                                                const parser = new DOMParser();
                                                const doc = parser.parseFromString(content, 'text/html');
                                                let currentCategory = 'é»˜è®¤åˆ†ç»„';
                                                
                                                // å…ˆå°è¯•ä½¿ç”¨æ ‡å‡†ä¹¦ç­¾æ ¼å¼è§£æï¼ˆNETSCAPE-Bookmark-file-1ï¼‰
                                                const h3Elements = doc.querySelectorAll('h3');
                                                let foundBookmarks = false;
                                                
                                                if (h3Elements.length > 0) {
                                                        // æŒ‰åˆ†ç±»åˆ†ç»„è§£æ
                                                        h3Elements.forEach(h3 => {
                                                                currentCategory = h3.textContent.trim() || 'é»˜è®¤åˆ†ç»„';
                                                                const dl = h3.closest('dl');
                                                                if (dl) {
                                                                        const aElements = dl.querySelectorAll('dt > a');
                                                                        aElements.forEach(a => {
                                                                                if (a.closest('h3') !== h3 && a.closest('dl') === dl) {
                                                                                        const name = a.textContent.trim() || 'æœªå‘½å';
                                                                                        const url = a.getAttribute('href') || '';
                                                                                        const title = a.getAttribute('title') || '';
                                                                                        const dd = a.closest('dt').nextElementSibling && a.closest('dt').nextElementSibling.tagName === 'DD'
                                                                                                ? a.closest('dt').nextElementSibling.textContent.trim()
                                                                                                : '';
                                                                                        
                                                                                        importedData.bookmarks.push({
                                                                                                name,
                                                                                                url,
                                                                                                desc: title || dd,
                                                                                                category: currentCategory,
                                                                                                background: getRandomGradient(),
                                                                                                added: Date.now()
                                                                                        });
                                                                                        foundBookmarks = true;
                                                                                }
                                                                        });
                                                                }
                                                        });
                                                }
                                                
                                                // å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ ‡å‡†æ ¼å¼çš„ä¹¦ç­¾ï¼Œå°è¯•è§£ææ™®é€šHTMLä¸­çš„æ‰€æœ‰é“¾æ¥
                                                if (!foundBookmarks) {
                                                        const aElements = doc.querySelectorAll('a:not([href="#"]):not([href="javascript:void(0)"])');
                                                        aElements.forEach(a => {
                                                                const name = a.textContent.trim() || 'æœªå‘½å';
                                                                const url = a.getAttribute('href') || '';
                                                                if (url && url.length > 1) {
                                                                        importedData.bookmarks.push({
                                                                                name,
                                                                                url,
                                                                                desc: a.getAttribute('title') || '',
                                                                                category: 'é»˜è®¤åˆ†ç»„',
                                                                                background: getRandomGradient(),
                                                                                added: Date.now()
                                                                        });
                                                                        foundBookmarks = true;
                                                                }
                                                        });
                                                }
                                                
                                                if (!foundBookmarks) {
                                                        throw new Error('æ— æ•ˆçš„ HTML æ–‡ä»¶æ ¼å¼ï¼Œæœªæ‰¾åˆ°ä¹¦ç­¾æ•°æ®');
                                                }
                                        } catch (htmlParseError) {
                                                console.error('HTMLè§£æé”™è¯¯:', htmlParseError);
                                                throw new Error('è§£æHTMLä¹¦ç­¾æ–‡ä»¶å¤±è´¥: ' + htmlParseError.message);
                                        }
                                        if (importedData.bookmarks.length === 0) {
                                                throw new Error('æ— æ•ˆçš„ HTML æ–‡ä»¶æ ¼å¼ï¼Œæœªæ‰¾åˆ°ä¹¦ç­¾æ•°æ®');
                                        }
                                } else {
                                        throw new Error('ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œä»…æ”¯æŒ .jsonã€.txt å’Œ .html');
                                }

                                let newBookmarks = 0, duplicateBookmarks = 0;
                                const existingUrls = new Set(state.bookmarks.map(b => b.url));
                                importedData.bookmarks.forEach(b => {
                                        if (!existingUrls.has(b.url)) {
                                                state.bookmarks.push({
                                                        name: b.name,
                                                        url: b.url,
                                                        desc: b.desc || '',
                                                        category: b.category || 'é»˜è®¤åˆ†ç»„',
                                                        background: b.background || getRandomGradient(),
                                                        added: b.added || Date.now()
                                                });
                                                existingUrls.add(b.url);
                                                newBookmarks++;
                                        } else {
                                                duplicateBookmarks++;
                                        }
                                });

                                let newMessage = '', duplicateMessage = '';
                                if (importedData.message) {
                                        const existingMessage = state.message || '';
                                        if (existingMessage.includes(importedData.message)) {
                                                duplicateMessage = 'ç•™è¨€æ¿å†…å®¹é‡å¤ï¼Œæœªè¿½åŠ ';
                                        } else {
                                                state.message = existingMessage ? `${existingMessage}\n${importedData.message}` : importedData.message;
                                                newMessage = 'ç•™è¨€æ¿å†…å®¹å·²è¿½åŠ ';
                                        }
                                }

                                if (state.bookmarks.length > MAX_BOOKMARKS) {
                                        alert(`ä¹¦ç­¾æ•°é‡è¶…è¿‡ä¸Šé™ (${MAX_BOOKMARKS})ï¼Œè¯·å‡å°‘åé‡è¯•ã€‚`);
                                } else if (saveToLocalStorageImmediately()) {
                                        state.currentPage = 1;
                                        filterBookmarks();
                                        renderBookmarks();
                                        renderCategories();
                                        alert(`å¯¼å…¥å®Œæˆï¼\nä¹¦ç­¾ï¼šæ–°å¢ ${newBookmarks} æ¡ï¼Œé‡å¤ ${duplicateBookmarks} æ¡è·³è¿‡\n${newMessage || duplicateMessage || 'æ— ç•™è¨€æ¿å†…å®¹'}`);
                                        if (navigator.onLine) {
                                                setTimeout(() => renderBookmarks(), 500);
                                        }
                                }
                        } catch (err) {
                                console.error('å¯¼å…¥å¤±è´¥ï¼š', err);
                                alert('å¯¼å…¥å¤±è´¥ï¼š' + err.message);
                        } finally {
                                state.isImporting = false;
                                // ç¡®ä¿eventå’Œevent.targetä¸ä¸ºnull
                                if (event && event.target) {
                                        event.target.value = '';
                                }
                        }
                };
                reader.onerror = function() {
                        alert('è¯»å–æ–‡ä»¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æŸåã€‚');
                        state.isImporting = false;
                        // ç¡®ä¿eventå’Œevent.targetä¸ä¸ºnull
                        if (event && event.target) {
                                event.target.value = '';
                        }
                };
                reader.readAsText(file);
        }

        function showSortModal() {
                showModal('sort-modal');
        }

        function hideSortModal() {
                hideModal('sort-modal');
        }

        function applySort(criteria) {
                if (criteria === 'added-desc') {
                        state.bookmarks.sort((a, b) => b.added - a.added);
                } else if (criteria === 'added-asc') {
                        state.bookmarks.sort((a, b) => a.added - b.added);
                } else if (criteria === 'title-asc') {
                        state.bookmarks.sort((a, b) => a.name.localeCompare(b.name));
                } else if (criteria === 'title-desc') {
                        state.bookmarks.sort((a, b) => b.name.localeCompare(a.name));
                }
                saveToLocalStorageImmediately();
                filterBookmarks();
                renderBookmarks();
                hideSortModal();
        }

        function showHelpModal() {
                showModal('help-modal');
        }

        function hideHelpModal() {
                hideModal('help-modal');
        }

        function toggleMessageForm() {
                const messageInput = document.getElementById('message-input');
                messageInput.value = state.message || '';
                messageInput.setAttribute('readonly', 'readonly');
                document.getElementById('save-message-btn').style.display = 'none';
                document.getElementById('cancel-message-btn').style.display = 'none';
                document.getElementById('close-message-btn').style.display = 'block';
                showModal('message-form');
        }

        function saveMessage() {
                const messageInput = document.getElementById('message-input');
                state.message = messageInput.value.trim();
                if (saveToLocalStorageImmediately()) {
                        messageInput.setAttribute('readonly', 'readonly');
                        document.getElementById('save-message-btn').style.display = 'none';
                        document.getElementById('cancel-message-btn').style.display = 'none';
                        document.getElementById('close-message-btn').style.display = 'block';
                }
        }

        function cancelMessageEdit() {
                const messageInput = document.getElementById('message-input');
                messageInput.value = state.message || '';
                messageInput.setAttribute('readonly', 'readonly');
                document.getElementById('save-message-btn').style.display = 'none';
                document.getElementById('cancel-message-btn').style.display = 'none';
                document.getElementById('close-message-btn').style.display = 'block';
        }

        // è‡ªåŠ¨ä¿å­˜è®¡æ—¶å™¨
        let autoSaveTimer = null;
        
        // åˆ›å»ºä¿å­˜æˆåŠŸæç¤ºå…ƒç´ 
        function createSaveNotification() {
                let notification = document.getElementById('save-notification');
                if (!notification) {
                        notification = document.createElement('div');
                        notification.id = 'save-notification';
                        notification.style.position = 'fixed';
                        notification.style.bottom = '20px';
                        notification.style.right = '20px';
                        notification.style.background = 'rgba(40, 167, 69, 0.9)';
                        notification.style.color = 'white';
                        notification.style.padding = '10px 20px';
                        notification.style.borderRadius = '5px';
                        notification.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
                        notification.style.zIndex = '2000';
                        notification.style.fontSize = '14px';
                        notification.style.opacity = '0';
                        notification.style.transition = 'opacity 0.3s ease';
                        document.body.appendChild(notification);
                }
                return notification;
        }
        
        // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
        function showSaveNotification() {
                const notification = createSaveNotification();
                notification.textContent = 'å·²è‡ªåŠ¨ä¿å­˜';
                notification.style.opacity = '1';
                
                setTimeout(() => {
                        notification.style.opacity = '0';
                }, 2000);
        }
        
        // é‡ç½®è‡ªåŠ¨ä¿å­˜è®¡æ—¶å™¨
        function resetAutoSaveTimer() {
                if (autoSaveTimer) {
                        clearTimeout(autoSaveTimer);
                }
                
                autoSaveTimer = setTimeout(() => {
                        const messageInput = document.getElementById('message-input');
                        // åªæœ‰åœ¨ç¼–è¾‘æ¨¡å¼ä¸‹ä¸”å†…å®¹æœ‰å˜åŒ–æ‰è‡ªåŠ¨ä¿å­˜
                        if (!messageInput.hasAttribute('readonly')) {
                                saveMessage();
                                showSaveNotification();
                        }
                }, 3000); // 3ç§’åè‡ªåŠ¨ä¿å­˜
        }
        
        document.getElementById('message-input').addEventListener('dblclick', () => {
                const messageInput = document.getElementById('message-input');
                messageInput.removeAttribute('readonly');
                messageInput.focus();
                document.getElementById('save-message-btn').style.display = 'block';
                document.getElementById('cancel-message-btn').style.display = 'block';
                document.getElementById('close-message-btn').style.display = 'none';
        });
        
        // æ·»åŠ å†…å®¹å˜åŒ–äº‹ä»¶ç›‘å¬ï¼Œè§¦å‘è‡ªåŠ¨ä¿å­˜
        document.getElementById('message-input').addEventListener('input', resetAutoSaveTimer);

        function showWelcomeModal() {
                if (state.isFirstRun) {
                        showModal('welcome-modal');
                        localStorage.setItem('hasRunBefore', 'true');
                        state.isFirstRun = false;
                }
        }

        function hideWelcomeModal() {
                hideModal('welcome-modal');
        }

        function toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                const toggleBtn = document.getElementById('toggle-sidebar-btn');
                sidebar.classList.toggle('wide');
                
                if (sidebar.classList.contains('wide')) {
                        // ä¾§è¾¹æ å±•å¼€çŠ¶æ€
                        toggleBtn.textContent = 'â¤';
                        toggleBtn.style.transform = 'rotate(180deg)';
                } else {
                        // ä¾§è¾¹æ æŠ˜å çŠ¶æ€ï¼ˆå®Œå…¨éšè—ï¼‰
                        toggleBtn.textContent = 'â—„';
                        toggleBtn.style.transform = 'rotate(0deg)';
                }
        }

        function renderCategories() {
                const categoriesContainer = document.getElementById('categories');
                const allCategories = new Set(state.bookmarks.map(bookmark => bookmark.category));
                
                // é»˜è®¤æ’åº
                const sortedCategories = ['å…¨éƒ¨ä¹¦ç­¾', ...Array.from(allCategories).sort()];
                
                state.categories = new Set(sortedCategories);

                // è·å–ç°æœ‰åˆ†ç±»é¡¹
                const existingItems = new Map();
                categoriesContainer.querySelectorAll('.category-item').forEach(item => {
                        const category = item.textContent;
                        existingItems.set(category, item);
                });

                // æ›´æ–°æˆ–åˆ›å»ºåˆ†ç±»é¡¹
                sortedCategories.forEach(category => {
                        let item = existingItems.get(category);
                        const isNew = !item;

                        if (!item) {
                                item = document.createElement('div');
                                item.className = 'category-item';
                                categoriesContainer.appendChild(item);
                        }

                        item.className = `category-item ${state.selectedCategory === category ? 'active' : ''}`;
                        item.textContent = category;
                        item.title = category;
                        
                        // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆé˜²æ­¢é‡å¤ç»‘å®šï¼‰
                        const newItem = isNew ? item : item.cloneNode(true);
                        
                        if (!isNew) {
                            categoriesContainer.replaceChild(newItem, item);
                            item = newItem;
                        }
                        
                        // é‡æ–°ç»‘å®šç‚¹å‡»äº‹ä»¶
                        item.onclick = () => {
                            state.selectedCategory = category;
                            state.currentPage = 1;
                            filterBookmarks();
                            renderBookmarks();
                            renderCategories();
                        };
                          
                        // æ·»åŠ åˆ†ç±»æ‹–æ‹½åŠŸèƒ½
                        item.draggable = true;
                        item.dataset.category = category;

                        existingItems.delete(category); // å·²å¤„ç†ï¼Œç§»é™¤æ ‡è®°
                });

                // ç§»é™¤å¤šä½™çš„åˆ†ç±»é¡¹
                existingItems.forEach(item => item.remove());
        }

        function updateCategoryFilter() {
                const allCategories = new Set(state.bookmarks.map(bookmark => bookmark.category));
                allCategories.add('å…¨éƒ¨ä¹¦ç­¾');
                state.categories = allCategories;
                renderCategories();
        }

        function filterBookmarks() {
                if (!Array.isArray(state.bookmarks)) {
                        state.bookmarks = [];
                }
                state.filteredBookmarks = state.bookmarks.filter(bookmark => {
                        const matchesCategory = state.selectedCategory === 'å…¨éƒ¨ä¹¦ç­¾' || bookmark.category === state.selectedCategory;
                        // æ·»åŠ searchå…ƒç´ å­˜åœ¨æ€§æ£€æŸ¥
                        const searchElement = document.getElementById('search');
                        const searchTerm = searchElement ? searchElement.value.toLowerCase() : '';
                        const matchesSearch = !searchTerm || bookmark.name.toLowerCase().includes(searchTerm);
                        return matchesCategory && matchesSearch;
                });
                state.currentPage = Math.min(state.currentPage, Math.max(1, Math.ceil(state.filteredBookmarks.length / getItemsPerPage())));
        }

        // æ˜¾ç¤ºæœç´¢æ¨¡æ€æ¡†
        function showSearchModal() {
                const searchModal = document.getElementById('search-modal');
                if (!searchModal) return;
                
                showModal('search-modal');
                
                // æ·»åŠ ç‚¹å‡»å¤–éƒ¨å…³é—­åŠŸèƒ½
                const handleOverlayClick = function(e) {
                        // ç¡®ä¿ç‚¹å‡»çš„æ˜¯é®ç½©å±‚è€Œä¸æ˜¯å¼¹çª—å†…å®¹
                        if (e.target.id === 'overlay' || e.target.id === 'search-modal-close') {
                                hideSearchModal();
                                document.removeEventListener('click', handleOverlayClick);
                        }
                };
                
                // å»¶è¿Ÿæ·»åŠ äº‹ä»¶ç›‘å¬ä»¥é¿å…è§¦å‘å…³é—­
                setTimeout(() => {
                        document.addEventListener('click', handleOverlayClick);
                }, 10);
                
                // è·å–ç„¦ç‚¹åˆ°æœç´¢æ¡†
                setTimeout(() => {
                        const searchInput = document.getElementById('search-modal-input');
                        if (searchInput) {
                                searchInput.focus();
                                // æ¸…ç©ºè¾“å…¥æ¡†
                                searchInput.value = '';
                                // æ¸…ç©ºæœç´¢ç»“æœ
                                clearSearchResults();
                        }
                }, 100);
        }

        // éšè—æœç´¢æ¨¡æ€æ¡†
        function hideSearchModal() {
                hideModal('search-modal');
                // ç§»é™¤ç‚¹å‡»å¤–éƒ¨å…³é—­çš„äº‹ä»¶ç›‘å¬
                const overlay = document.getElementById('overlay');
                if (overlay) {
                        overlay.onclick = hideAllModals;
                }
        }

        // æ¸…ç©ºæœç´¢ç»“æœ
        function clearSearchResults() {
                const searchResults = document.getElementById('search-results');
                const noResults = document.getElementById('no-search-results');
                if (searchResults) {
                        searchResults.innerHTML = '';
                }
                if (noResults) {
                        noResults.style.display = 'none';
                }
        }

        // åœ¨æ¨¡æ€æ¡†ä¸­æ‰§è¡Œæœç´¢
        // ç”Ÿæˆéšæœºæµ…è‰²æ¸å˜èƒŒæ™¯çš„å‡½æ•°
        function generateRandomGradient() {
                // åŸºäºç½‘ç«™ä¸»é¢˜è‰²çš„æµ…è‰²å˜ä½“
                const colors = [
                        'rgba(0, 123, 255, 0.05), rgba(0, 123, 255, 0.1)', // è“è‰²æ¸å˜
                        'rgba(40, 167, 69, 0.05), rgba(40, 167, 69, 0.1)',  // ç»¿è‰²æ¸å˜
                        'rgba(108, 117, 125, 0.05), rgba(108, 117, 125, 0.1)', // ç°è‰²æ¸å˜
                        'rgba(220, 53, 69, 0.05), rgba(220, 53, 69, 0.1)',  // çº¢è‰²æ¸å˜
                        'rgba(255, 193, 7, 0.05), rgba(255, 193, 7, 0.1)',  // é»„è‰²æ¸å˜
                        'rgba(138, 43, 226, 0.05), rgba(138, 43, 226, 0.1)',  // ç´«è‰²æ¸å˜
                        'rgba(255, 99, 71, 0.05), rgba(255, 99, 71, 0.1)',  // æ©™è‰²æ¸å˜
                        'rgba(0, 128, 128, 0.05), rgba(0, 128, 128, 0.1)'   // é’è‰²æ¸å˜
                ];
                
                // éšæœºé€‰æ‹©ä¸€ç§æ¸å˜é¢œè‰²
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                
                // éšæœºå†³å®šæ¸å˜æ–¹å‘
                const directions = ['to right', 'to left', 'to bottom', 'to top', 'to bottom right', 'to bottom left', 'to top right', 'to top left'];
                const randomDirection = directions[Math.floor(Math.random() * directions.length)];
                
                // è¿”å›å®Œæ•´çš„æ¸å˜èƒŒæ™¯æ ·å¼
                return `linear-gradient(${randomDirection}, ${randomColor})`;
        }
        
        function performModalSearch() {
                // ä¼˜åŒ–ï¼šä½¿ç”¨ç¼“å­˜çš„DOMå…ƒç´ å¼•ç”¨
                if (!searchModalInput) {
                        searchModalInput = document.getElementById('search-modal-input');
                        if (!searchModalInput) return;
                }
                
                const searchResults = document.getElementById('search-results');
                const noResults = document.getElementById('no-search-results');
                const loadingIndicator = document.getElementById('loading-indicator');
                
                if (!searchResults || !noResults) {
                        return;
                }
                
                // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
                if (loadingIndicator) loadingIndicator.style.display = 'block';
                
                const searchTerm = searchInput.value.trim().toLowerCase();
                
                // æ¸…ç©ºä¹‹å‰çš„æœç´¢ç»“æœ
                searchResults.innerHTML = '';
                
                if (!searchTerm) {
                        noResults.style.display = 'none';
                        return;
                }
                
                // è¿‡æ»¤åŒ¹é…çš„ä¹¦ç­¾
                const matchedBookmarks = state.bookmarks.filter(bookmark => 
                        bookmark.name.toLowerCase().includes(searchTerm)
                );
                
                if (matchedBookmarks.length === 0) {
                        noResults.style.display = 'block';
                } else {
                        noResults.style.display = 'none';
                        
                        // æ¸²æŸ“æœç´¢ç»“æœåˆ—è¡¨
                        matchedBookmarks.forEach(bookmark => {
                                const resultItem = document.createElement('div');
                                resultItem.className = 'search-result-item';
                                // åº”ç”¨éšæœºæµ…è‰²æ¸å˜èƒŒæ™¯
                                resultItem.style.background = generateRandomGradient();
                                
                                // ç‚¹å‡»åç§°æŸ¥çœ‹è¯¦æƒ…
                                const nameElement = document.createElement('span');
                                nameElement.className = 'search-result-name';
                                nameElement.textContent = bookmark.name;
                                nameElement.onclick = (e) => {
                                        e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
                                        
                                        // ç›´æ¥æ˜¾ç¤ºä¹¦ç­¾è¯¦æƒ…ï¼Œä¸ä¿®æ”¹å…¨å±€filteredBookmarks
                                        const tempBookmarkIndex = state.bookmarks.findIndex(b => b.url === bookmark.url && b.name === bookmark.name);
                                        if (tempBookmarkIndex !== -1) {
                                                // ä¸´æ—¶ä¿å­˜å½“å‰è¿‡æ»¤å™¨å’Œåˆ†ç±»çŠ¶æ€
                                                const tempFilter = state.searchFilter;
                                                const tempCategory = state.selectedCategory;
                                                 
                                                // è¿‡æ»¤å‡ºå½“å‰ä¹¦ç­¾
                                                state.filteredBookmarks = [state.bookmarks[tempBookmarkIndex]];
                                                state.searchFilter = '';
                                                state.selectedCategory = bookmark.category;
                                                 
                                                // æ˜¾ç¤ºè¯¦æƒ…
                                                showBookmarkDetails(0);
                                                 
                                                // æ¢å¤åŸå§‹çŠ¶æ€
                                                setTimeout(() => {
                                                        state.searchFilter = tempFilter;
                                                        state.selectedCategory = tempCategory;
                                                        filterBookmarks();
                                                        renderBookmarks();
                                                }, 0);
                                        }
                                };
                                
                                // URLé“¾æ¥
                                const urlElement = document.createElement('a');
                                urlElement.className = 'search-result-url';
                                urlElement.textContent = bookmark.url || 'æ— é“¾æ¥';
                                urlElement.href = bookmark.url || 'javascript:void(0)';
                                urlElement.target = '_blank';
                                urlElement.onclick = (e) => {
                                        e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
                                        if (!bookmark.url) {
                                                e.preventDefault();
                                        }
                                };
                                
                                resultItem.appendChild(nameElement);
                                resultItem.appendChild(urlElement);
                                searchResults.appendChild(resultItem);
                        });
                }
                
                // éšè—åŠ è½½æŒ‡ç¤ºå™¨
                if (loadingIndicator) loadingIndicator.style.display = 'none';
        }

        // ä¼˜åŒ–ï¼šç¼“å­˜å¸¸ç”¨DOMå…ƒç´ å¼•ç”¨
        let searchModalInput = null;
        let debouncedSearch = null;

        // ä¸ºæœç´¢æ¡†æ·»åŠ å®æ—¶æœç´¢åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
                searchModalInput = document.getElementById('search-modal-input');
                if (searchModalInput) {
                        // æ·»åŠ é˜²æŠ–å¤„ç†çš„å®æ—¶æœç´¢
                        debouncedSearch = debounce(performModalSearch, 300);
                        // æ·»åŠ è¾“å…¥äº‹ä»¶ç›‘å¬å®ç°å®æ—¶æœç´¢
                        searchModalInput.addEventListener('input', debouncedSearch);
                        // æ·»åŠ å›è½¦é”®æœç´¢åŠŸèƒ½ï¼ˆå…¼å®¹å·²æœ‰ä¹ æƒ¯ï¼‰
                        searchModalInput.addEventListener('keypress', function(e) {
                                if (e.key === 'Enter') {
                                        performModalSearch();
                                }
                        });
                }
        });

        // ä¿ç•™åŸæ¥çš„æœç´¢åŠŸèƒ½ï¼Œä½†ä¸å†åœ¨ä¸»ç•Œé¢æ˜¾ç¤ºæœç´¢æ¡†
        function searchBookmarks() {
                state.currentPage = 1;
                filterBookmarks();
                renderBookmarks();
        }

        function getItemsPerPage() {
                return 24;
        }

        function renderPagination() {
                const pagination = document.getElementById('pagination');
                const itemsPerPage = getItemsPerPage();
                const totalPages = Math.ceil(state.filteredBookmarks.length / itemsPerPage);
                const total = state.bookmarks.length;
                const displayed = Math.min(state.filteredBookmarks.length - (state.currentPage - 1) * itemsPerPage, 24);
                pagination.innerHTML = '';

                if (total <= 12 && displayed <= 12) {
                        pagination.style.display = 'none';
                        return;
                }

                pagination.style.display = 'flex';

                const prevBtn = document.createElement('button');
                prevBtn.textContent = 'ä¸Šä¸€é¡µ';
                prevBtn.disabled = state.currentPage === 1;
                prevBtn.onclick = () => {
                        if (state.currentPage > 1) {
                                state.currentPage--;
                                renderBookmarks();
                        }
                };
                pagination.appendChild(prevBtn);

                const maxVisiblePages = 5;
                let startPage = Math.max(1, state.currentPage - Math.floor(maxVisiblePages / 2));
                let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
                startPage = Math.max(1, endPage - maxVisiblePages + 1);

                for (let i = startPage; i <= endPage; i++) {
                        const btn = document.createElement('button');
                        btn.textContent = i;
                        btn.className = state.currentPage === i ? 'active' : '';
                        btn.onclick = () => {
                                state.currentPage = i;
                                renderBookmarks();
                        };
                        pagination.appendChild(btn);
                }

                const nextBtn = document.createElement('button');
                nextBtn.textContent = 'ä¸‹ä¸€é¡µ';
                nextBtn.disabled = state.currentPage === totalPages;
                nextBtn.onclick = () => {
                        if (state.currentPage < totalPages) {
                                state.currentPage++;
                                renderBookmarks();
                        }
                };
                pagination.appendChild(nextBtn);
        }

        function updateStats() {
                const stats = document.getElementById('stats');
                const total = state.bookmarks.length;
                const categoriesCount = state.categories.size - 1;
                const displayed = Math.min(state.filteredBookmarks.length - (state.currentPage - 1) * getItemsPerPage(), 24);
                const currentCategoryCount = state.selectedCategory === 'å…¨éƒ¨ä¹¦ç­¾' 
                        ? total 
                        : state.bookmarks.filter(b => b.category === state.selectedCategory).length;

                if (total > 12 || displayed > 12) {
                        stats.style.display = 'block';
                        stats.textContent = `æ€»ä¹¦ç­¾æ•°ï¼š${total} | æ€»åˆ†ç»„æ•°ï¼š${categoriesCount} | å½“å‰é¡µæ˜¾ç¤ºä¹¦ç­¾å¡ç‰‡æ•°ï¼š${displayed} | å½“å‰åˆ†ç»„ä¹¦ç­¾æ•°ï¼š${currentCategoryCount} | `;
                } else {
                        stats.style.display = 'none';
                }
        }

        function addBookmark(name, url, category, desc) {
                const newBookmark = {
                        name: name.trim(),
                        url: url.trim(),
                        category: category.trim() || 'é»˜è®¤åˆ†ç»„',
                        desc: desc.trim(),
                        background: getRandomGradient(),
                        added: Date.now()
                };
                state.bookmarks.push(newBookmark);
                state.categories.add(newBookmark.category);
                state.categories.add('å…¨éƒ¨ä¹¦ç­¾');
                saveToLocalStorageImmediately();
                filterBookmarks();
                renderBookmarks();
                updateCategoryFilter();
        }

        function renderBookmarks() {
                if (state.isRendering || state.isImporting) return;
                state.isRendering = true;

                const loadingIndicator = document.getElementById('loading-indicator');
                if (loadingIndicator) loadingIndicator.style.display = 'block';

                try {
                        const container = document.getElementById('bookmarks');
                        const tips = document.getElementById('tips');
                        if (!container || !tips) {
                                console.error('Container or tips element not found');
                                state.isRendering = false;
                                if (loadingIndicator) loadingIndicator.style.display = 'none';
                                return;
                        }

                        const itemsPerPage = getItemsPerPage();
                        const startIndex = (state.currentPage - 1) * itemsPerPage;
                        const endIndex = Math.min(startIndex + itemsPerPage, state.filteredBookmarks.length);
                        const visibleBookmarks = state.filteredBookmarks.slice(startIndex, endIndex);
                        const isOnline = navigator.onLine;

                        // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºç©ºçŠ¶æ€
                        const isEmptyState = container.classList.contains('empty-state');

                        if (state.filteredBookmarks.length === 0) {
                                container.className = 'empty-state';
                                container.innerHTML = `
                                        <div class="ribbons">
                                                <div class="ribbon"></div>
                                                <div class="ribbon"></div>
                                                <div class="ribbon"></div>
                                        </div>
                                        <div class="cartoon-book">
                                                <div class="book-spine"></div>
                                                <div class="book-cover"></div>
                                                <div class="book-page"></div>
                                                <div class="bookmark"></div>
                                        </div>
                                        <h2>æ¬¢è¿ä½¿ç”¨ä¹¦ç­¾ç®¡ç†å™¨</h2>
                                        <p>ç›®å‰è¿˜æ²¡æœ‰ä¹¦ç­¾ï¼Œå¿«æ¥æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä¹¦ç­¾å§ï¼æˆ–è€…å¯¼å…¥å·²æœ‰ä¹¦ç­¾ï¼Œå¿«é€Ÿå¼€å§‹ç®¡ç†ã€‚</p>
                                        <div class="button-group">
                                                <button class="action-btn" onclick="toggleAddForm(true)">â• æ·»åŠ ä¹¦ç­¾</button>
                                                <button class="action-btn secondary-btn" onclick="document.getElementById('import-file').click()">ğŸ“¥ å¯¼å…¥ä¹¦ç­¾</button>
                                        </div>
                                `;
                                tips.style.display = 'none';
                                document.getElementById('pagination').style.display = 'none';
                                document.getElementById('stats').style.display = 'none';
                        } else {
                                // å¦‚æœä¹‹å‰æ˜¯ç©ºçŠ¶æ€ï¼Œæ¸…é™¤å†…å®¹å¹¶åˆ‡æ¢åˆ°ä¹¦ç­¾å¡ç‰‡æ¨¡å¼
                                if (isEmptyState) {
                                        container.innerHTML = ''; // æ¸…é™¤ç©ºçŠ¶æ€å†…å®¹
                                }
                                container.className = 'bookmark-grid';
                                tips.style.display = 'block';

                                // è·å–ç°æœ‰å¡ç‰‡
                                const existingCards = new Map();
                                container.querySelectorAll('.bookmark-card').forEach(card => {
                                        const index = parseInt(card.dataset.index);
                                        if (!isNaN(index)) existingCards.set(index, card);
                                });

                                // æ›´æ–°æˆ–åˆ›å»ºå¡ç‰‡
                                visibleBookmarks.forEach((bookmark, index) => {
                                        // ç”¨å½“å‰é¡µç´¢å¼•ä½œä¸ºdata-indexï¼Œä¿è¯æ‹–æ‹½å’ŒDOMé¡ºåºä¸€è‡´
                                        let card = existingCards.get(index);
                                        const isNew = !card;

                                        if (!card) {
                                                card = document.createElement('div');
                                                card.className = `bookmark-card${state.isEditMode ? ' edit-mode' : ''}`;
                                                card.draggable = !state.isEditMode;
                                                container.appendChild(card);
                                        } else {
                                                card.className = `bookmark-card${state.isEditMode ? ' edit-mode' : ''}`;
                                                card.draggable = !state.isEditMode;
                                                existingCards.delete(index);
                                        }

                                        card.dataset.index = index;
                                        card.style.background = bookmark.background || getRandomGradient();

                                        const displayName = bookmark.name.length > 10 ? bookmark.name.substring(0, 10) + '...' : bookmark.name;
                                        const displayCategory = bookmark.category.length > 10 ? bookmark.category.substring(0, 10) + '...' : bookmark.category;
                                        const bookmarkGlobalIndex = state.bookmarks.indexOf(bookmark);

                                        // è¿›ä¸€æ­¥ä¼˜åŒ–çš„ favicon åŠ è½½é€»è¾‘ï¼Œå‡å°‘æ§åˆ¶å°é”™è¯¯
                                        let faviconHtml = '';
                                        if (isOnline && bookmark.url) {
                                                try {
                                                        const urlObj = new URL(bookmark.url);
                                                        const faviconUrl = `${urlObj.origin}/favicon.ico`;
                                                        // ä½¿ç”¨ç®€å•çš„å ä½ç¬¦ï¼Œé¿å…ç›´æ¥åˆ›å»ºå¯èƒ½å¤±è´¥çš„imgå…ƒç´ 
                                                        // ä»…åœ¨å®é™…éœ€è¦æ˜¾ç¤ºæ—¶é€šè¿‡JSåŠ è½½ï¼Œå‡å°‘ä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚
                                                        faviconHtml = `<span class="favicon-placeholder" data-favicon-url="${faviconUrl}"></span>`;
                                                } catch (e) {
                                                        // æ•è·URLè§£æé”™è¯¯ï¼Œé¿å…æ§åˆ¶å°æŠ¥é”™
                                                        faviconHtml = '';
                                                }
                                        }

                                        const backContent = bookmark.desc
                                                ? `<span class="desc-title">ä¹¦ç­¾ç®€ä»‹</span><p class="desc">${escapeHtml(bookmark.desc)}</p>`
                                                : `<span class="no-desc">æ­¤ä¹¦ç­¾æš‚æ— ç®€ä»‹</span>`;

                                        // æ£€æŸ¥å†…å®¹æ˜¯å¦éœ€è¦æ›´æ–°
                                        const newInnerHTML = `
                                                <div class="main-card-container">
                                                        <div class="main-card">
                                                                <div class="main-card-front">
                                                                        <div class="bookmark-content">
                                                                                <h3>
                                                                                        <span class="favicon-container">${faviconHtml}</span>
                                                                                        <span class="title-text" data-index="${index}">${escapeHtml(displayName)}</span>
                                                                                        <input type="checkbox" class="bookmark-checkbox${state.isEditMode ? ' visible' : ''}" data-global-index="${bookmarkGlobalIndex}">
                                                                                </h3>
                                                                                <p class="url"><a href="${escapeHtml(bookmark.url)}" target="_blank">${escapeHtml(bookmark.url)}</a></p>
                                                                                <div class="desc-container">
                                                                                        <p class="desc">${escapeHtml(bookmark.desc)}</p>
                                                                                </div>
                                                                        </div>
                                                                        <div class="action-bar">
                                                                                <span class="category-tag">${escapeHtml(displayCategory)}</span>
                                                                                <div class="action-buttons" style="${state.isEditMode ? 'display: flex;' : 'display: none;'}">
                                                                                        <button class="edit-btn" data-index="${index}">âœï¸ ç¼–è¾‘</button>
                                                                                        <button class="delete-btn" data-index="${index}">ğŸ—‘ï¸ åˆ é™¤</button>
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                <div class="main-card-back">
                                                                        ${backContent}
                                                                </div>
                                                        </div>
                                                        <div class="hover-area"></div>
                                                </div>
                                        `;

                                        if (card.innerHTML !== newInnerHTML) {
                                                card.innerHTML = newInnerHTML;
                                        }

                                        // æ›´æ–°åˆ†ç±»æ ‡ç­¾é¢œè‰²
                                        const categoryTag = card.querySelector('.category-tag');
                                        if (categoryTag) {
                                                categoryTag.style.backgroundColor = getCategoryColor(bookmark.category);
                                        }
                                });

                                // ç§»é™¤å¤šä½™çš„å¡ç‰‡
                                existingCards.forEach(card => card.remove());

                                // äº‹ä»¶å§”æ‰˜ï¼ˆä»…ç»‘å®šä¸€æ¬¡ï¼‰
                                if (!container.clickHandler) {
                                        container.clickHandler = (e) => {
                                                const target = e.target;
                                                if (target.classList.contains('title-text')) {
                                                        showBookmarkDetails(parseInt(target.dataset.index));
                                                } else if (target.classList.contains('edit-btn')) {
                                                        editBookmark(parseInt(target.dataset.index));
                                                } else if (target.classList.contains('delete-btn')) {
                                                        deleteBookmark(parseInt(target.dataset.index));
                                                } else if (state.isEditMode && target.closest('.bookmark-card')) {
                                                        const checkbox = target.closest('.bookmark-card').querySelector('.bookmark-checkbox');
                                                        if (checkbox && !target.closest('.action-buttons') && !target.classList.contains('bookmark-checkbox')) {
                                                                checkbox.checked = !checkbox.checked;
                                                                toggleBookmarkSelection(parseInt(checkbox.dataset.globalIndex), checkbox.checked);
                                                        }
                                                }
                                        };
                                        container.mouseEnterHandler = (e) => {
                                                if (!state.isEditMode && e.target.classList.contains('hover-area')) {
                                                        const mainCard = e.target.previousElementSibling;
                                                        if (mainCard) mainCard.classList.add('flipped');
                                                }
                                        };
                                        container.mouseLeaveHandler = (e) => {
                                                if (!state.isEditMode && e.target.closest('.bookmark-card')) {
                                                        const card = e.target.closest('.bookmark-card');
                                                        const mainCard = card.querySelector('.main-card');
                                                        if (mainCard && !card.contains(e.relatedTarget)) {
                                                                mainCard.classList.remove('flipped');
                                                        }
                                                }
                                        };
                                        container.addEventListener('click', container.clickHandler);
                                        container.addEventListener('mouseenter', container.mouseEnterHandler, true);
                                        container.addEventListener('mouseleave', container.mouseLeaveHandler, true);
                                }

                                renderPagination();
                                updateStats();
                        }
                } catch (e) {
                        console.error('æ¸²æŸ“ä¹¦ç­¾å¤±è´¥ï¼š', e);
                } finally {
                        state.isRendering = false;
                        if (loadingIndicator) loadingIndicator.style.display = 'none';
                }
        }

        // ç§»é™¤æ—¥å¿—åŠŸèƒ½ï¼Œä¼˜åŒ–æ€§èƒ½
        
        // ä¾§è¾¹æ åˆ†ç±»æ‹–æ‹½æ’åºåŠŸèƒ½
        function setupCategoryDragAndDrop() {
                let draggedCategory = null;
                
                
                
                // ä¸ºåˆ†ç±»é¡¹æ·»åŠ æ‹–æ‹½ç›¸å…³äº‹ä»¶
                function addDragEventsToCategoryItems() {
                        const categoryItems = document.querySelectorAll('.category-item');
                        
                        categoryItems.forEach(item => {
                                const categoryName = item.dataset.category || item.textContent;
                                
                                // ä¸å…è®¸æ‹–æ‹½"å…¨éƒ¨ä¹¦ç­¾"åˆ†ç±»
                                const isAllBookmarks = categoryName === 'å…¨éƒ¨ä¹¦ç­¾';
                                if (isAllBookmarks) {
                                        item.draggable = false;
                                        item.style.cursor = 'default';
                                } else {
                                        // ç¡®ä¿å…¶ä»–åˆ†ç±»é¡¹å§‹ç»ˆå¯æ‹–æ‹½
                                        item.draggable = true;
                                        item.style.cursor = 'grab'; // ä½¿ç”¨æ‹–æ‹½å…‰æ ‡
                                }
                                
                                // ç¡®ä¿æœ‰data-categoryå±æ€§
                                if (!item.dataset.category) {
                                        item.dataset.category = categoryName;
                                }

                                // ä¿ç•™åŸæ¥çš„ç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•°å¼•ç”¨
                                const originalClickHandler = item.onclick;

                                // é˜²æ­¢é‡å¤æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼Œå…ˆç§»é™¤æ‰€æœ‰å·²å­˜åœ¨çš„æ‹–æ‹½äº‹ä»¶
                                const newItem = item.cloneNode(true);
                                item.parentNode.replaceChild(newItem, item);

                                // å¢å¼ºçš„ç‚¹å‡»äº‹ä»¶å¤„ç†
                                newItem.onclick = function(e) {
                                    // æ‰§è¡ŒåŸå§‹ç‚¹å‡»é€»è¾‘
                                    if (originalClickHandler && typeof originalClickHandler === 'function') {
                                        originalClickHandler.apply(this, arguments);
                                    }
                                    
                                    // ç¡®ä¿å³ä½¿ç‚¹å‡»äº†"å…¨éƒ¨ä¹¦ç­¾"ï¼Œå…¶ä»–åˆ†ç±»é¡¹çš„æ‹–æ‹½åŠŸèƒ½ä»ç„¶å¯ç”¨
                                    // å»¶è¿Ÿé‡æ–°ç»‘å®šæ‹–æ‹½äº‹ä»¶ï¼Œç¡®ä¿DOMæ›´æ–°å®Œæˆ
                                    setTimeout(() => {
                                        addDragEventsToCategoryItems();
                                    }, 50);
                                };
                                
                                // æ·»åŠ æ‹–æ‹½å¼€å§‹äº‹ä»¶
                                newItem.addEventListener('dragstart', function(e) {
                                        draggedCategory = this;
                                        
                                        // è®¾ç½®æ‹–æ‹½æ•°æ®
                                        e.dataTransfer.effectAllowed = 'move';
                                        
                                        // æ·»åŠ æ‹–æ‹½æ ·å¼
                                        setTimeout(() => {
                                                this.classList.add('dragging');
                                                this.style.opacity = '0.6';
                                        }, 0);
                                        

                                });
                                
                                // æ·»åŠ æ‹–æ‹½ç»“æŸäº‹ä»¶
                                newItem.addEventListener('dragend', function() {
                                        // æ¸…ç†æ‹–æ‹½çŠ¶æ€
                                        this.classList.remove('dragging');
                                        this.style.opacity = '1';
                                        
                                        // æ¸…ç†æ‰€æœ‰æ”¾ç½®ç›®æ ‡æ ·å¼
                                        document.querySelectorAll('.category-item.drop-target').forEach(el => {
                                                el.classList.remove('drop-target');
                                        });
                                        
                                        draggedCategory = null;
                                        

                                });
                                
                                // æ·»åŠ æ‹–æ‹½ç»è¿‡äº‹ä»¶ - ä¼˜åŒ–ç‰ˆæœ¬
                                newItem.addEventListener('dragover', function(e) {
                                        e.preventDefault();
                                        e.dataTransfer.dropEffect = 'move';
                                        
                                        // ä¸å…è®¸æ‹–æ‹½åˆ°è‡ªèº«
                                        if (this === draggedCategory) {
                                                this.classList.remove('drop-target', 'drop-target-before', 'drop-target-after');
                                                return;
                                        }
                                        
                                        // è·å–é¼ æ ‡åœ¨å…ƒç´ ä¸­çš„ä½ç½®ï¼Œå†³å®šæ˜¯ä¸Šè¾¹æ¡†è¿˜æ˜¯ä¸‹è¾¹æ¡†é«˜äº®
                                        const rect = this.getBoundingClientRect();
                                        const mouseY = e.clientY - rect.top;
                                        const elementHeight = rect.height;
                                        
                                        // ç§»é™¤æ‰€æœ‰æ”¾ç½®ç›®æ ‡æ ·å¼
                                        document.querySelectorAll('.category-item.drop-target, .category-item.drop-target-before, .category-item.drop-target-after').forEach(el => {
                                                if (el !== this && el !== draggedCategory) {
                                                        el.classList.remove('drop-target', 'drop-target-before', 'drop-target-after');
                                                }
                                        });
                                        
                                        // æè‡´ç®€åŒ–åˆ¤å®šæ¡ä»¶ï¼Œåªè¦é¼ æ ‡è¿›å…¥å°±æ˜¾ç¤ºè¾¹æ¡†
                                        this.classList.remove('drop-target', 'drop-target-before', 'drop-target-after');
                                        
                                        // æ— æ¡ä»¶æ˜¾ç¤ºæ‰€æœ‰æç¤ºæ ·å¼ï¼Œç¡®ä¿è¾¹æ¡†æ€»æ˜¯å¯è§
                                        this.classList.add('drop-target', 'drop-target-before', 'drop-target-after');
                                        
                                        // ä¿å­˜å½“å‰é¼ æ ‡ä½ç½®ä¿¡æ¯ï¼Œç”¨äºæ”¾ç½®æ—¶çš„ä½ç½®åˆ¤æ–­
                                        this.dataset.mouseY = mouseY;
                                        this.dataset.elementHeight = elementHeight;
                                        
                                        // ç¡®ä¿æ ·å¼ç«‹å³ç”Ÿæ•ˆ
                                        this.style.transition = 'none';
                                        this.offsetHeight; // å¼ºåˆ¶é‡ç»˜
                                        setTimeout(() => {
                                            this.style.transition = '';
                                        }, 0);
                                });
                                
                                // æ·»åŠ æ‹–æ‹½ç¦»å¼€äº‹ä»¶ - ä¼˜åŒ–ç‰ˆæœ¬
                                newItem.addEventListener('dragleave', function() {
                                        // å¿«é€Ÿç§»é™¤é«˜äº®ï¼Œä¸å†å»¶è¿Ÿ
                                        this.classList.remove('drop-target', 'drop-target-before', 'drop-target-after');
                                });
                                
                                // æ·»åŠ æ”¾ç½®äº‹ä»¶ - ä¼˜åŒ–ç‰ˆæœ¬
                                newItem.addEventListener('drop', function(e) {
                                        e.preventDefault();
                                        
                                        // ç¡®ä¿æœ‰æ‹–æ‹½å…ƒç´ ä¸”ä¸æ˜¯æ‹–æ‹½åˆ°è‡ªèº«
                                        if (!draggedCategory || draggedCategory === this) {
                                                this.classList.remove('drop-target', 'drop-target-before', 'drop-target-after');
                                                return;
                                        }
                                        
                                        const fromCategory = draggedCategory.dataset.category;
                                        const toCategory = this.dataset.category;
                                        
                                        // ç§»é™¤æ‰€æœ‰æ”¾ç½®ç›®æ ‡æ ·å¼
                                        document.querySelectorAll('.category-item.drop-target, .category-item.drop-target-before, .category-item.drop-target-after').forEach(el => {
                                                el.classList.remove('drop-target', 'drop-target-before', 'drop-target-after');
                                        });
                                        
                                        try {
                                                // è·å–æ‰€æœ‰ç”¨æˆ·è‡ªå®šä¹‰åˆ†ç±»
                                                const userCategories = Array.from(state.categories).filter(cat => cat !== 'å…¨éƒ¨ä¹¦ç­¾');
                                                
                                                // æ‰¾åˆ°è¦ç§»åŠ¨çš„ç´¢å¼•
                                                const fromIndex = userCategories.indexOf(fromCategory);
                                                const toIndex = userCategories.indexOf(toCategory);
                                                
                                                if (fromIndex !== -1 && toIndex !== -1 && fromIndex !== toIndex) {
                                                        // æœ€ç®€åŒ–çš„ä½ç½®åˆ¤æ–­é€»è¾‘ï¼Œç¡®ä¿åªè¦æ˜¾ç¤ºè¾¹æ¡†å°±èƒ½äº¤æ¢
                                                        let insertPosition = toIndex;
                                                          
                                                        // é»˜è®¤æ”¾åœ¨ç›®æ ‡åˆ†ç±»çš„åé¢ï¼Œç®€åŒ–é€»è¾‘
                                                        insertPosition = toIndex + 1;
                                                          
                                                        // è¾¹ç•Œæ£€æŸ¥ï¼Œç¡®ä¿ç´¢å¼•æœ‰æ•ˆ
                                                        if (insertPosition > userCategories.length) {
                                                                insertPosition = userCategories.length;
                                                        }
                                                        if (insertPosition < 0) {
                                                                insertPosition = 0;
                                                        }
                                                        

                                                        
                                                        // ç§»é™¤åŸä½ç½®çš„åˆ†ç±»
                                                        const movedCategory = userCategories.splice(fromIndex, 1)[0];
                                                        
                                                        // è®¡ç®—æ–°ä½ç½® (å¦‚æœæ’å…¥ä½ç½®åœ¨åŸç´¢å¼•ä¹‹åï¼Œéœ€è¦å‡1ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»ç§»é™¤äº†ä¸€ä¸ªå…ƒç´ )
                                                        const newIndex = insertPosition > fromIndex ? insertPosition - 1 : insertPosition;
                                                        
                                                        // åœ¨æ–°ä½ç½®æ’å…¥åˆ†ç±»
                                                        userCategories.splice(newIndex, 0, movedCategory);
                                                        
                                                        // æ›´æ–°çŠ¶æ€
                                                        state.categories = new Set(['å…¨éƒ¨ä¹¦ç­¾', ...userCategories]);
                                                        
                                                        // å‚è€ƒä¹¦ç­¾å¡ç‰‡äº¤æ¢æ–¹å¼ï¼Œä½¿ç”¨å ä½ç¬¦ä¿æŒå…¶ä»–åˆ†ç±»é¡¹ä½ç½®ä¸å˜
                                                        const fromElement = document.querySelector(`.category-item[data-category="${fromCategory}"]`);
                                                        const toElement = this;
                                                        
                                                        if (fromElement && toElement) {
                                                            // è·å–å®¹å™¨
                                                            const container = toElement.parentElement;
                                                             
                                                            // ä½¿ç”¨é€šç”¨çš„DOMèŠ‚ç‚¹äº¤æ¢å‡½æ•°
                                                            swapDOMNodes(container, fromElement, toElement);
                                                                 
                                                                // ä¿å­˜åŸå§‹èƒŒæ™¯è‰²
                                                                const originalFromBg = fromElement.style.backgroundColor || '';
                                                                const originalToBg = toElement.style.backgroundColor || '';
                                                                 
                                                                // ç¡®ä¿è¿‡æ¸¡æ•ˆæœå¹³æ»‘
                                                                fromElement.style.transition = 'background-color 0.4s cubic-bezier(0.25, 0.1, 0.25, 1)';
                                                                toElement.style.transition = 'background-color 0.4s cubic-bezier(0.25, 0.1, 0.25, 1)';
                                                                 
                                                                // ä½¿ç”¨requestAnimationFrameç¡®ä¿åŠ¨ç”»å¹³æ»‘
                                                                requestAnimationFrame(() => {
                                                                    // ç”Ÿæˆéšæœºæµ…è‰²ä½œä¸ºé«˜äº®è‰²
                                                                    const randomColor = getRandomLightColor();
                                                                     
                                                                    // è®¾ç½®éšæœºæµ…è‰²èƒŒæ™¯é«˜äº®
                                                                    fromElement.style.backgroundColor = randomColor;
                                                                    toElement.style.backgroundColor = randomColor;
                                                                     
                                                                    // åŠ¨ç”»å®Œæˆåæ¢å¤åŸæ¥çš„èƒŒæ™¯è‰²
                                                                    setTimeout(() => {
                                                                        requestAnimationFrame(() => {
                                                                            fromElement.style.backgroundColor = originalFromBg;
                                                                            toElement.style.backgroundColor = originalToBg;
                                                                               
                                                                            // å»¶è¿Ÿç§»é™¤è¿‡æ¸¡æ•ˆæœä»¥ç¡®ä¿åŠ¨ç”»å®Œå…¨å®Œæˆ
                                                                            setTimeout(() => {
                                                                                fromElement.style.transition = '';
                                                                                toElement.style.transition = '';
                                                                            }, 400);
                                                                        });
                                                                    }, 400);
                                                                });
                                                        }
                                                         

                                                        
                                                        // ä¿å­˜æ›´æ”¹
                                                        saveToLocalStorageImmediately();
                                                         
                                                        // ä¸éœ€è¦é‡æ–°æ¸²æŸ“åˆ†ç±»ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»é€šè¿‡DOMæ“ä½œæ›´æ–°äº†ä½ç½®
                                                        // renderCategoriesDirect();
                                                } else {
                                                        // ç´¢å¼•æ— æ•ˆï¼Œé™é»˜å¤„ç†
                                                }
                                        } catch (error) {
                                                console.error('åˆ†ç±»æ‹–æ‹½ç§»åŠ¨å¤±è´¥: ' + error.message);
                                        }
                                });
                        });
                }
                
                // ç›´æ¥æ¸²æŸ“åˆ†ç±»çš„å‡½æ•°ï¼Œä¼˜åŒ–ç‰ˆæœ¬ - åªæ›´æ–°å†…å®¹ä¸é‡å»ºDOM
                function renderCategoriesDirect() {
                        const categoriesContainer = document.getElementById('categories');
                        const allCategories = Array.from(state.categories);
                         
                        // ä¸ç›´æ¥æ¸…ç©ºå®¹å™¨ï¼Œè€Œæ˜¯æ›´æ–°ç°æœ‰å…ƒç´ å†…å®¹å’Œé¡ºåº
                        const existingItems = Array.from(categoriesContainer.querySelectorAll('.category-item'));
                         
                        if (existingItems.length === allCategories.length) {
                            // å¦‚æœæ•°é‡ç›¸åŒï¼Œåªéœ€æ›´æ–°å†…å®¹å’Œé¡ºåº
                            allCategories.forEach((category, index) => {
                                // æ‰¾åˆ°å¯¹åº”çš„æ•°æ®é¡¹
                                const item = existingItems.find(el => el.dataset.category === category) || existingItems[index];
                                
                                // æ›´æ–°å†…å®¹å’ŒçŠ¶æ€
                                item.textContent = category;
                                item.title = category;
                                item.dataset.category = category;
                                
                                // æ›´æ–°æ¿€æ´»çŠ¶æ€
                                if (state.selectedCategory === category) {
                                    item.classList.add('active');
                                } else {
                                    item.classList.remove('active');
                                }
                                 
                                // ç¡®ä¿æ­£ç¡®çš„é¡ºåº
                                if (index < categoriesContainer.children.length - 1) {
                                    categoriesContainer.insertBefore(item, categoriesContainer.children[index + 1]);
                                }
                            });
                        } else {
                            // å¦‚æœæ•°é‡ä¸åŒï¼Œæ‰æ¸…ç©ºå¹¶é‡å»ºï¼ˆè¿™ç§æƒ…å†µåº”è¯¥å¾ˆå°‘å‘ç”Ÿï¼‰
                            categoriesContainer.innerHTML = '';
                             
                            // é‡æ–°åˆ›å»ºæ‰€æœ‰åˆ†ç±»é¡¹
                            allCategories.forEach(category => {
                                const item = document.createElement('div');
                                item.className = `category-item ${state.selectedCategory === category ? 'active' : ''}`;
                                item.textContent = category;
                                item.title = category;
                                item.dataset.category = category;
                                 
                                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                                item.onclick = () => {
                                    state.selectedCategory = category;
                                    state.currentPage = 1;
                                    filterBookmarks();
                                    renderBookmarks();
                                    renderCategoriesDirect(); // ä½¿ç”¨ç›´æ¥æ¸²æŸ“å‡½æ•°ï¼Œä¿æŒæ‹–æ‹½æ’åº
                                };
                                 
                                categoriesContainer.appendChild(item);
                            });
                        }
                         
                        // é‡æ–°æ·»åŠ æ‹–æ‹½äº‹ä»¶
                        setTimeout(addDragEventsToCategoryItems, 0);
                }
                
                // åˆå§‹è°ƒç”¨ä¸€æ¬¡
                addDragEventsToCategoryItems();
        }
        
        // ä¹¦ç­¾å¡ç‰‡æ‹–æ‹½æ’åºåŠŸèƒ½
        function setupDragAndDrop() {
                let draggedCard = null;
                let draggedIndex = null;
                let lastDropTarget = null;
                let bookmarksContainer = null;

                // åˆå§‹åŒ–å®¹å™¨å¼•ç”¨
                function getBookmarksContainer() {
                        if (!bookmarksContainer) {
                                bookmarksContainer = document.getElementById('bookmarks');
                        }
                        return bookmarksContainer;
                }

                // é˜²æŠ–å¤„ç†dragoveräº‹ä»¶
                let debounceTimer;
                function handleDragOver(e) {
                        e.preventDefault();
                        if (!draggedCard) return;

                        clearTimeout(debounceTimer);
                        debounceTimer = setTimeout(() => {
                                // å¿«é€Ÿæ£€æµ‹é¼ æ ‡ä¸‹çš„å¡ç‰‡ï¼Œæé«˜çµæ•åº¦
                                let dropTarget = e.target.closest('.bookmark-card:not(.dragging)');
                                
                                // å¢å¼ºæ‹–æ‹½çµæ•åº¦ï¼Œæ‰©å¤§æ£€æµ‹èŒƒå›´
                                if (!dropTarget && e.clientY) {
                                    const cards = Array.from(getBookmarksContainer().querySelectorAll('.bookmark-card:not(.dragging)'));
                                    for (const card of cards) {
                                        const rect = card.getBoundingClientRect();
                                        // æ‰©å¤§å‚ç›´å’Œæ°´å¹³æ£€æµ‹èŒƒå›´ï¼Œæé«˜çµæ•åº¦
                                        if (e.clientY >= rect.top - 20 && e.clientY <= rect.bottom + 20 &&
                                            e.clientX >= rect.left - 10 && e.clientX <= rect.right + 10) {
                                            dropTarget = card;
                                            break;
                                        }
                                    }
                                }
                                
                                // ç§»é™¤ä¸Šä¸€ä¸ªç›®æ ‡çš„é«˜äº®
                                if (lastDropTarget && lastDropTarget !== dropTarget) {
                                        lastDropTarget.classList.remove('drop-target');
                                }
                                
                                // æ·»åŠ æ–°ç›®æ ‡çš„é«˜äº®
                                if (dropTarget && dropTarget !== draggedCard) {
                                        dropTarget.classList.add('drop-target');
                                        lastDropTarget = dropTarget;
                                }
                        }, 15); // æ›´ä½çš„é˜²æŠ–å»¶è¿Ÿï¼Œå¤§å¹…æé«˜å“åº”é€Ÿåº¦
                }

                document.addEventListener('dragstart', (e) => {
                        // åªæœ‰åœ¨éç¼–è¾‘æ¨¡å¼ä¸‹æ‰èƒ½æ‹–æ‹½ï¼Œä¸”ç¡®ä¿ç›®æ ‡æ˜¯ä¹¦ç­¾å¡ç‰‡
                        if (state.isEditMode || !e.target.classList.contains('bookmark-card')) return;
                        
                        draggedCard = e.target;
                        draggedIndex = parseInt(draggedCard.dataset.index);
                        
                        // ç¡®ä¿ç´¢å¼•æœ‰æ•ˆ
                        if (isNaN(draggedIndex) || draggedIndex < 0) {
                                console.warn('æ— æ•ˆçš„ä¹¦ç­¾ç´¢å¼•:', draggedIndex);
                                return;
                        }
                        
                        draggedCard.classList.add('dragging');
                        // ä½¿ç”¨setTimeoutç¡®ä¿æ ·å¼ç«‹å³ç”Ÿæ•ˆ
                        setTimeout(() => draggedCard.style.opacity = '0.6', 0);
                });

                document.addEventListener('dragend', () => {
                        if (!draggedCard) return;
                        
                        // æ¸…ç†æ‹–æ‹½çŠ¶æ€
                        draggedCard.classList.remove('dragging');
                        draggedCard.style.opacity = '1';
                        
                        // æ¸…ç†æ”¾ç½®ç›®æ ‡çŠ¶æ€
                        if (lastDropTarget) {
                            lastDropTarget.classList.remove('drop-target');
                            lastDropTarget = null;
                        }
                        
                        // é‡ç½®çŠ¶æ€
                        draggedCard = null;
                        draggedIndex = null;
                        
                        // ä¿å­˜æ›´æ”¹
                        saveToLocalStorageImmediately();
                });

                document.addEventListener('dragover', handleDragOver);

                document.addEventListener('drop', (e) => {
                        e.preventDefault();
                        if (!draggedCard) return;
                        
                        // æ¸…é™¤é˜²æŠ–è®¡æ—¶å™¨
                        clearTimeout(debounceTimer);
                        
                        // è·å–æ”¾ç½®ç›®æ ‡
                        const dropTarget = e.target.closest('.bookmark-card:not(.dragging)');
                        
                        // æ¸…ç†æ”¾ç½®ç›®æ ‡é«˜äº®
                        if (lastDropTarget) {
                            lastDropTarget.classList.remove('drop-target');
                            lastDropTarget = null;
                        }
                        
                        // å¦‚æœæœ‰æœ‰æ•ˆç›®æ ‡ä¸”ä¸æ˜¯æ‹–æ‹½æºæœ¬èº«
                        if (dropTarget && dropTarget !== draggedCard) {
                            try {
                                // è·å–ç´¢å¼•
                                const fromIndex = parseInt(draggedCard.dataset.index);
                                const toIndex = parseInt(dropTarget.dataset.index);
                                
                                // éªŒè¯ç´¢å¼•æœ‰æ•ˆæ€§
                                if (isNaN(fromIndex) || isNaN(toIndex) || fromIndex < 0 || toIndex < 0) {
                                    console.warn('æ— æ•ˆçš„ç´¢å¼•å€¼:', {fromIndex, toIndex});
                                    return;
                                }
                                
                                // ç¡®ä¿ç´¢å¼•åœ¨èŒƒå›´å†…ä¸”ä¸ç›¸åŒ
                                if (fromIndex !== toIndex && fromIndex < state.filteredBookmarks.length && toIndex < state.filteredBookmarks.length) {
                                    // è·å–å¡ç‰‡å…ƒç´ 
                                    const fromCard = draggedCard;
                                    const toCard = dropTarget;
                                    
                                    // è·å–å¡ç‰‡ä½ç½®ä¿¡æ¯
                                    const fromRect = fromCard.getBoundingClientRect();
                                    const toRect = toCard.getBoundingClientRect();
                                    
                                    // è®¾ç½®åŠ¨ç”» - åªäº¤æ¢ä¸¤ä¸ªå¡ç‰‡çš„ä½ç½®
                                    fromCard.style.transition = 'transform 0.35s ease';
                                    toCard.style.transition = 'transform 0.35s ease';
                                    
                                    // è®¡ç®—ä½ç½®åç§»ï¼Œä½¿ä¸¤ä¸ªå¡ç‰‡äº¤æ¢ä½ç½®
                                    const dx = toRect.left - fromRect.left;
                                    const dy = toRect.top - fromRect.top;
                                    const dx2 = fromRect.left - toRect.left;
                                    const dy2 = fromRect.top - toRect.top;
                                    
                                    fromCard.style.transform = `translate(${dx}px,${dy}px)`;
                                    toCard.style.transform = `translate(${dx2}px,${dy2}px)`;
                                    
                                    // åŠ¨ç”»å®Œæˆåå¤„ç†æ•°æ®å’ŒDOM
                                    setTimeout(() => {
                                        // é‡ç½®æ ·å¼
                                        fromCard.style.transition = '';
                                        toCard.style.transition = '';
                                        fromCard.style.transform = '';
                                        toCard.style.transform = '';
                                        
                                        // äº¤æ¢è¿‡æ»¤åçš„æ•°æ®
                                        const temp = state.filteredBookmarks[fromIndex];
                                        state.filteredBookmarks[fromIndex] = state.filteredBookmarks[toIndex];
                                        state.filteredBookmarks[toIndex] = temp;
                                        
                                        // åŒæ­¥å…¨å±€bookmarksé¡ºåº - ä½¿ç”¨æ›´å¯é çš„åŒ¹é…æ–¹å¼
                                        try {
                                            // åˆ›å»ºä¸€ä¸ªæ›´å¯é çš„ä¹¦ç­¾åŒ¹é…å‡½æ•°ï¼Œä½¿ç”¨æ‰€æœ‰å±æ€§è¿›è¡Œæ¯”è¾ƒ
                                            const findGlobalIndex = (bookmarkToFind) => {
                                                // å…ˆå°è¯•ä½¿ç”¨å¼•ç”¨ç›¸ç­‰æŸ¥æ‰¾
                                                const directIndex = state.bookmarks.indexOf(bookmarkToFind);
                                                if (directIndex !== -1) return directIndex;
                                                 
                                                // å¦‚æœå¼•ç”¨æŸ¥æ‰¾å¤±è´¥ï¼Œä½¿ç”¨å±æ€§åŒ¹é…æŸ¥æ‰¾ï¼ˆä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆï¼‰
                                                return state.bookmarks.findIndex(b => 
                                                    b.name === bookmarkToFind.name &&
                                                    b.url === bookmarkToFind.url &&
                                                    b.desc === bookmarkToFind.desc &&
                                                    b.category === bookmarkToFind.category &&
                                                    b.added === bookmarkToFind.added
                                                );
                                            };
                                            
                                            // æŸ¥æ‰¾å…¨å±€ç´¢å¼•
                                            const globalFrom = findGlobalIndex(temp);
                                            const globalTo = findGlobalIndex(state.filteredBookmarks[fromIndex]);
                                            
                                            // ç¡®ä¿æ‰¾åˆ°æœ‰æ•ˆçš„å…¨å±€ç´¢å¼•
                                            if (globalFrom !== -1 && globalTo !== -1 && globalFrom !== globalTo) {
                                                const temp2 = state.bookmarks[globalFrom];
                                                state.bookmarks[globalFrom] = state.bookmarks[globalTo];
                                                state.bookmarks[globalTo] = temp2;
                                            } else {
                                                console.warn('æœªèƒ½åŒæ­¥å…¨å±€ä¹¦ç­¾é¡ºåº', {globalFrom, globalTo});
                                            }
                                        } catch (syncError) {
                                            console.error('åŒæ­¥å…¨å±€ä¹¦ç­¾é¡ºåºæ—¶å‡ºé”™:', syncError);
                                        }
                                        
                                        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                                        saveToLocalStorageImmediately();
                                        
                                        // äº¤æ¢DOMèŠ‚ç‚¹ - åªäº¤æ¢ä¸¤ä¸ªå¡ç‰‡ä½ç½®ï¼Œå…¶ä»–å¡ç‰‡ä½ç½®ä¸å˜
                                        const container = getBookmarksContainer();
                                        if (container && fromCard !== toCard) {
                                            // ä½¿ç”¨é€šç”¨çš„DOMèŠ‚ç‚¹äº¤æ¢å‡½æ•°
                                            if (swapDOMNodes(container, fromCard, toCard)) {
                                                // æ›´æ–°å¡ç‰‡çš„ç´¢å¼•æ•°æ®å±æ€§
                                                fromCard.dataset.index = toIndex;
                                                toCard.dataset.index = fromIndex;
                                            }
                                        }
                                    }, 350);
                                }
                            } catch (error) {
                                console.error('æ‹–æ”¾æ“ä½œæ—¶å‡ºé”™:', error);
                            }
                        }
                });
        }

        // ç»Ÿä¸€ç®¡ç†æ‰€æœ‰DOMContentLoadedäº‹ä»¶å¤„ç†
        document.addEventListener('DOMContentLoaded', function() {
                // æœç´¢æ¡†åŠŸèƒ½å·²åœ¨ä¸Šæ–¹ç»Ÿä¸€å®ç°
                // ä¸»è¦åˆå§‹åŒ–é€»è¾‘
                
                // ä¸»è¦åˆå§‹åŒ–é€»è¾‘
                setupDragAndDrop();
                loadBookmarks();
                
                // ç­‰æ•°æ®åŠ è½½å¹¶æ¸²æŸ“å®Œæˆåï¼Œå†è®¾ç½®åˆ†ç±»æ‹–æ‹½åŠŸèƒ½
                // ä½¿ç”¨setTimeoutç¡®ä¿loadBookmarkså†…éƒ¨çš„æ¸²æŸ“å®Œæˆ
                setTimeout(() => {
                        setupCategoryDragAndDrop();
                }, 100);
                
                showWelcomeModal();
                
                // å¤„ç†faviconå ä½ç¬¦ï¼Œå®ç°å»¶è¿ŸåŠ è½½
                setupFaviconLazyLoading();
        });
        
        // å»¶è¿ŸåŠ è½½faviconï¼Œå‡å°‘ä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚å’Œæ§åˆ¶å°é”™è¯¯
        function setupFaviconLazyLoading() {
                // åˆ›å»ºIntersectionObserverå®ä¾‹
                const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                                if (entry.isIntersecting) {
                                        const placeholder = entry.target;
                                        const faviconUrl = placeholder.dataset.faviconUrl;
                                        
                                        // åªåœ¨å…ƒç´ å¯è§æ—¶å°è¯•åŠ è½½favicon
                                        loadFaviconWithTimeout(faviconUrl, placeholder);
                                        
                                        // åœæ­¢è§‚å¯Ÿè¯¥å…ƒç´ 
                                        observer.unobserve(placeholder);
                                }
                        });
                }, {
                        rootMargin: '100px', // æå‰100pxè§¦å‘åŠ è½½
                        threshold: 0.1      // å½“10%çš„å…ƒç´ å¯è§æ—¶è§¦å‘
                });
                
                // è§‚å¯Ÿæ‰€æœ‰faviconå ä½ç¬¦
                document.querySelectorAll('.favicon-placeholder').forEach(placeholder => {
                        observer.observe(placeholder);
                });
        }
        
        // ç”Ÿæˆéšæœºæµ…è‰²çš„å‡½æ•° - ç§»åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œä¾¿äºå¤šå¤„ä½¿ç”¨
        function getRandomLightColor() {
                // ç”Ÿæˆéšæœºè‰²ç›¸ (0-360)
                const hue = Math.floor(Math.random() * 360);
                // è°ƒæ•´é¥±å’Œåº¦å’Œäº®åº¦ï¼Œä½¿é¢œè‰²ç¨æ·±ä½†ä¸é®æŒ¡æ–‡å­—
                const saturation = Math.floor(Math.random() * 30) + 20; // 20-50%
                const lightness = Math.floor(Math.random() * 20) + 70; // 70-90%
                 
                return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
        }
        
        // å¸¦è¶…æ—¶å¤„ç†çš„faviconåŠ è½½å‡½æ•° - ä¼˜åŒ–ç‰ˆ
        function loadFaviconWithTimeout(faviconUrl, placeholder) {
                // åˆ›å»ºæ–°çš„imgå…ƒç´ 
                const img = new Image();
                img.className = 'favicon';
                img.style.display = 'none'; // åˆå§‹éšè—
                
                // è®¾ç½®è¶…æ—¶å¤„ç†
                const timeoutId = setTimeout(() => {
                        // è¶…æ—¶åä¸å†å°è¯•åŠ è½½
                        img.onerror = null;
                        img.onload = null;
                        placeholder.style.display = 'none'; // éšè—å ä½ç¬¦
                }, 2000); // 2ç§’è¶…æ—¶
                
                // åŠ è½½æˆåŠŸå¤„ç†
                img.onload = function() {
                        clearTimeout(timeoutId); // æ¸…é™¤è¶…æ—¶
                        img.style.display = 'inline'; // æ˜¾ç¤ºå›¾ç‰‡
                        placeholder.parentNode.replaceChild(img, placeholder); // æ›¿æ¢å ä½ç¬¦
                };
                
                // åŠ è½½å¤±è´¥å¤„ç†
                img.onerror = function() {
                        clearTimeout(timeoutId); // æ¸…é™¤è¶…æ—¶
                        placeholder.style.display = 'none'; // éšè—å ä½ç¬¦
                };
                
                // è®¾ç½®srcå¼€å§‹åŠ è½½
                img.src = faviconUrl;
        }
        
        // é€šç”¨çš„äº¤æ¢DOMèŠ‚ç‚¹å‡½æ•°
        function swapDOMNodes(container, fromNode, toNode) {
                if (!container || !fromNode || !toNode || fromNode === toNode) {
                        return false;
                }
                
                try {
                        // ä¸ºä¸¤ä¸ªèŠ‚ç‚¹åˆ›å»ºä¸´æ—¶å ä½ç¬¦
                        const fromPlaceholder = document.createElement('div');
                        fromPlaceholder.style.height = fromNode.offsetHeight + 'px';
                        
                        const toPlaceholder = document.createElement('div');
                        toPlaceholder.style.height = toNode.offsetHeight + 'px';
                        
                        // æ’å…¥å ä½ç¬¦ä»¥ä¿æŒå…¶ä»–èŠ‚ç‚¹ä½ç½®ä¸å˜
                        container.insertBefore(fromPlaceholder, fromNode);
                        container.insertBefore(toPlaceholder, toNode);
                        
                        // ç§»é™¤åŸå§‹èŠ‚ç‚¹
                        container.removeChild(fromNode);
                        container.removeChild(toNode);
                        
                        // æ’å…¥åˆ°å¯¹æ–¹ä½ç½®
                        container.insertBefore(fromNode, toPlaceholder);
                        container.insertBefore(toNode, fromPlaceholder);
                        
                        // ç§»é™¤å ä½ç¬¦
                        container.removeChild(fromPlaceholder);
                        container.removeChild(toPlaceholder);
                        
                        return true;
                } catch (domError) {
                        console.error('äº¤æ¢DOMèŠ‚ç‚¹æ—¶å‡ºé”™:', domError);
                        return false;
                }
        }

        document.addEventListener('keydown', (e) => {
                if (!e) return;
                
                if (e.key === 'Escape') {
                        hideAllModals();
                } else if (e.ctrlKey && e.key === 's') {
                        e.preventDefault();
                        toggleAddForm(true);
                } else if (e.key === 'Enter') {
                        const addForm = document.getElementById('add-form');
                        if (addForm && addForm.style.display === 'block') {
                                saveBookmark();
                        }
                }
        });

        window.addEventListener('resize', debounce(() => {
                renderBookmarks();
        }, 300));
    </script>
</body>
</html>